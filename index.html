<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام إدارة الموارد البشرية المتكامل - مدرسة الثروات الوطنية الخاصة</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>
    
    <style>
        body { 
            font-family: 'Segoe UI', 'Cairo', Tahoma, Geneva, Verdana, sans-serif; 
            overflow-x: hidden;
        }
        
        /* Sidebar Styles */
        .sidebar {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translateX(100%);
            backdrop-filter: blur(10px);
            border-left: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .sidebar.open {
            transform: translateX(0);
        }
        
        .sidebar-overlay {
            transition: opacity 0.3s ease-in-out;
            opacity: 0;
            visibility: hidden;
        }
        
        .sidebar-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        @media (min-width: 1024px) {
            .sidebar {
                transform: translateX(0) !important;
                position: relative !important;
                backdrop-filter: none;
                border-left: none;
                border-left: 1px solid #e5e7eb;
            }
            .sidebar-overlay {
                display: none !important;
            }
            .main-content {
                margin-right: 280px;
            }
        }
        
        /* Professional Animations */
        .animate-fade-in {
            animation: fadeIn 0.6s ease-out;
        }
        
        .animate-slide-up {
            animation: slideUp 0.4s ease-out;
        }
        
        .animate-scale-in {
            animation: scaleIn 0.3s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes scaleIn {
            from { transform: scale(0.95); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        /* Navigation Styles */
        .nav-btn {
            position: relative;
            overflow: hidden;
        }
        
        .nav-btn:before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 0;
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s ease;
            z-index: -1;
        }
        
        .nav-btn.active:before,
        .nav-btn:hover:before {
            width: 100%;
        }
        
        .nav-btn.active {
            color: white;
            background: linear-gradient(90deg, #667eea, #764ba2);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        /* Card Styles */
        .card-shadow { 
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
        }
        
        .card-shadow:hover {
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
            transform: translateY(-2px);
        }
        
        /* Stats Cards */
        .stats-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.7) 100%);
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }
        
        .dark .stats-card {
            background: linear-gradient(135deg, rgba(31, 41, 55, 0.9) 0%, rgba(31, 41, 55, 0.7) 100%);
            border: 1px solid rgba(75, 85, 99, 0.3);
        }
        
        /* Form Elements */
        .input-group {
            position: relative;
        }
        
        .input-group label {
            position: absolute;
            top: -8px;
            right: 12px;
            background: white;
            padding: 0 8px;
            font-size: 12px;
            color: #667eea;
            font-weight: 600;
            z-index: 10;
        }
        
        .dark .input-group label {
            background: #1f2937;
            color: #a5b4fc;
        }
        
        /* Table Styles */
        .table-hover tbody tr {
            transition: all 0.2s ease;
        }
        
        .table-hover tbody tr:hover {
            background-color: rgba(102, 126, 234, 0.05);
            transform: translateX(-2px);
        }
        
        .dark .table-hover tbody tr:hover {
            background-color: rgba(102, 126, 234, 0.1);
        }
        
        /* Loading Animation */
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Notification Styles */
        .notification {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
        }
        
        .notification.hide {
            transform: translateX(100%);
            opacity: 0;
        }
        
        /* Enhanced Professional Form Templates for A4 */
        .form-template {
            background: white;
            border: 2px solid #1e40af;
            width: 210mm;
            height: 297mm;
            max-height: 297mm;
            padding: 12mm;
            margin: 0 auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
            font-size: 10px;
            line-height: 1.2;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            font-family: 'Segoe UI', 'Cairo', Tahoma, sans-serif;
        }
        
        .form-header {
            text-align: center;
            border-bottom: 2px solid #1e40af;
            padding-bottom: 8px;
            margin-bottom: 12px;
            flex-shrink: 0;
        }
        
        .form-title {
            font-size: 18px;
            font-weight: bold;
            color: #1e40af;
            margin-bottom: 4px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        
        .form-subtitle {
            font-size: 10px;
            color: #64748b;
            margin-bottom: 3px;
        }
        
        .form-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .form-content-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 8px;
        }
        
        .form-info-field {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 3px 0;
            border-bottom: 1px solid #e2e8f0;
            font-size: 9px;
            min-height: 14px;
        }
        
        .form-info-field .label {
            font-weight: 600;
            color: #475569;
            min-width: 80px;
            font-size: 9px;
        }
        
        .form-info-field .value {
            color: #1e293b;
            font-weight: 500;
            font-size: 9px;
            text-align: left;
        }
        
        .form-section {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border: 1px solid #e2e8f0;
            border-right: 3px solid #3b82f6;
            padding: 6px;
            margin-bottom: 6px;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .form-section h3 {
            font-size: 11px;
            font-weight: bold;
            color: #1e40af;
            margin-bottom: 4px;
            text-decoration: underline;
        }
        
        .form-section p {
            font-size: 9px;
            line-height: 1.3;
            margin-bottom: 4px;
        }
        
        .form-footer {
            margin-top: auto;
            padding-top: 8px;
            border-top: 2px solid #1e40af;
            flex-shrink: 0;
        }
        
        .signature-section {
            text-align: center;
            margin-bottom: 6px;
        }
        
        .signature-line {
            height: 1px;
            background: #374151;
            margin: 4px 0;
            width: 100px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .official-seal {
            width: 40px;
            height: 40px;
            border: 2px solid #374151;
            border-radius: 50%;
            margin: 4px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 7px;
            text-align: center;
            color: #374151;
            font-weight: bold;
        }
        
        .form-table {
            width: 100%;
            border-collapse: collapse;
            margin: 4px 0;
            font-size: 8px;
        }
        
        .form-table th,
        .form-table td {
            border: 1px solid #d1d5db;
            padding: 2px;
            text-align: right;
            vertical-align: middle;
            height: 16px;
        }
        
        .form-table th {
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
            font-weight: bold;
            color: #374151;
            font-size: 8px;
        }
        
        .checkbox-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3px;
            margin: 4px 0;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            font-size: 8px;
            padding: 1px;
        }
        
        .checkbox-item input[type="checkbox"] {
            margin-left: 3px;
            transform: scale(0.7);
        }
        
        .editable-field {
            border: 1px solid #d1d5db;
            border-radius: 2px;
            padding: 2px;
            min-height: 10px;
            background: white;
            margin: 1px 0;
            font-size: 8px;
        }
        
        .company-header {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 6px;
            padding: 6px;
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            border-radius: 4px;
            border: 1px solid #bfdbfe;
        }
        
        .company-logo {
            width: 30px;
            height: 30px;
            object-fit: contain;
            margin-left: 6px;
            border-radius: 3px;
        }
        
        .company-info {
            text-align: right;
        }
        
        .company-name {
            font-size: 11px;
            font-weight: bold;
            color: #1e40af;
            margin-bottom: 1px;
        }
        
        .company-address {
            font-size: 7px;
            color: #64748b;
            line-height: 1.2;
        }
        
        .signature-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-top: 8px;
        }
        
        .signature-grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 8px;
        }
        
        /* Dark Mode */
        .dark {
            --tw-bg-opacity: 1;
            background-color: rgb(17 24 39 / var(--tw-bg-opacity));
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #5a6fd8;
        }

        /* Logo upload styles */
        .logo-preview {
            max-width: 80px;
            max-height: 80px;
            border-radius: 8px;
            border: 2px solid #e5e7eb;
        }
        
        /* Enhanced Print Styles for A4 */
        @media print {
            .no-print { display: none !important; }
            body { 
                -webkit-print-color-adjust: exact;
                margin: 0;
                padding: 0;
            }
            .sidebar, .sidebar-overlay, .main-content { 
                display: none !important; 
            }
            
            .form-template {
                width: 210mm !important;
                height: 297mm !important;
                max-height: 297mm !important;
                min-height: 297mm !important;
                margin: 0 !important;
                padding: 10mm !important;
                box-shadow: none !important;
                border: 1px solid #000 !important;
                overflow: hidden !important;
                page-break-inside: avoid !important;
                font-size: 9px !important;
                line-height: 1.2 !important;
                display: flex !important;
                flex-direction: column !important;
                justify-content: space-between !important;
            }
            
            .form-header {
                border-bottom: 1px solid #000 !important;
                padding-bottom: 6px !important;
                margin-bottom: 8px !important;
                flex-shrink: 0 !important;
            }
            
            .form-title {
                font-size: 16px !important;
                color: #000 !important;
                margin-bottom: 3px !important;
            }
            
            .form-subtitle {
                font-size: 9px !important;
                color: #333 !important;
            }
            
            .form-content {
                flex: 1 !important;
                gap: 4px !important;
            }
            
            .form-info-field {
                font-size: 8px !important;
                padding: 2px 0 !important;
                border-bottom: 1px solid #ccc !important;
                min-height: 12px !important;
            }
            
            .form-section {
                background: #f8f8f8 !important;
                border: 1px solid #ccc !important;
                border-right: 2px solid #000 !important;
                padding: 4px !important;
                margin-bottom: 4px !important;
                page-break-inside: avoid !important;
            }
            
            .form-section h3 {
                font-size: 10px !important;
                color: #000 !important;
                margin-bottom: 3px !important;
            }
            
            .form-section p {
                font-size: 8px !important;
                margin-bottom: 2px !important;
            }
            
            .form-footer {
                margin-top: auto !important;
                padding-top: 6px !important;
                border-top: 1px solid #000 !important;
                flex-shrink: 0 !important;
            }
            
            .signature-section {
                margin-bottom: 6px !important;
            }
            
            .signature-line {
                background: #000 !important;
                height: 1px !important;
                width: 80px !important;
                margin: 3px auto !important;
            }
            
            .official-seal {
                width: 30px !important;
                height: 30px !important;
                border: 1px solid #000 !important;
                font-size: 6px !important;
                margin: 4px auto !important;
            }
            
            .form-table {
                font-size: 7px !important;
                margin: 2px 0 !important;
            }
            
            .form-table th,
            .form-table td {
                padding: 1px !important;
                height: 12px !important;
                font-size: 7px !important;
            }
            
            .checkbox-item {
                font-size: 7px !important;
            }
            
            .editable-field {
                min-height: 8px !important;
                font-size: 7px !important;
            }
            
            .company-header {
                padding: 4px !important;
                margin-bottom: 4px !important;
            }
            
            .company-logo {
                width: 25px !important;
                height: 25px !important;
            }
            
            .company-name {
                font-size: 10px !important;
            }
            
            .company-address {
                font-size: 6px !important;
            }
        }
        
        /* Section Content */
        .section-content {
            display: none;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.4s ease;
        }
        
        .section-content.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }
        
        /* Progress Indicators */
        .progress-bar {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            height: 4px;
            border-radius: 2px;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .grid-cols-md-2 {
                grid-template-columns: 1fr;
            }
            
            .text-responsive {
                font-size: 0.875rem;
            }
            
            .form-template {
                width: 100% !important;
                padding: 15px !important;
                font-size: 12px !important;
            }
        }
    </style>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { 
                        primary: '#667eea',
                        secondary: '#764ba2',
                        accent: '#f093fb'
                    },
                    fontFamily: { 
                        arabic: ['Segoe UI', 'Cairo', 'Tahoma', 'Geneva', 'Verdana', 'sans-serif'] 
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.6s ease-out',
                        'slide-up': 'slideUp 0.4s ease-out',
                        'scale-in': 'scaleIn 0.3s ease-out',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            },
            darkMode: 'class'
        }
    </script>
</head>

<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-all duration-300">
    <!-- Loading Screen -->
    <div id="loading-screen" class="fixed inset-0 bg-white dark:bg-gray-900 z-50 flex items-center justify-center">
        <div class="text-center animate-scale-in">
            <div class="loading-spinner mx-auto mb-4"></div>
            <p class="text-lg font-medium text-primary">جاري تحميل النظام...</p>
            <div class="progress-bar w-32 mx-auto mt-4"></div>
        </div>
    </div>

    <!-- Sidebar Overlay -->
    <div id="sidebar-overlay" class="sidebar-overlay fixed inset-0 bg-black bg-opacity-60 z-40 lg:hidden"></div>

    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar fixed right-0 top-0 h-full w-80 bg-white dark:bg-gray-800 shadow-2xl z-50 lg:w-72">
        <!-- Sidebar Header -->
        <div class="p-6 border-b border-gray-200 dark:border-gray-700">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3 space-x-reverse">
                    <div class="w-12 h-12 bg-gradient-to-br from-primary to-secondary rounded-xl flex items-center justify-center shadow-lg">
                        <i class="fas fa-graduation-cap text-white text-xl"></i>
                    </div>
                    <div>
                        <h2 class="text-lg font-bold text-primary">نظام الموارد البشرية</h2>
                        <p class="text-sm text-gray-500 dark:text-gray-400">مدرسة الثروات الوطنية</p>
                    </div>
                </div>
                <button onclick="toggleSidebar()" class="lg:hidden p-2 rounded-lg text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
        </div>

        <!-- Navigation Menu -->
        <nav class="p-4 space-y-1 flex-1 overflow-y-auto">
            <button onclick="showSection('dashboard')" class="nav-btn w-full text-right p-4 rounded-xl transition-all flex items-center space-x-3 space-x-reverse hover:bg-gray-50 dark:hover:bg-gray-700">
                <i class="fas fa-chart-dashboard w-5 text-lg"></i>
                <span class="font-medium">لوحة التحكم</span>
            </button>
            
            <button onclick="showSection('employees')" class="nav-btn w-full text-right p-4 rounded-xl transition-all flex items-center space-x-3 space-x-reverse hover:bg-gray-50 dark:hover:bg-gray-700">
                <i class="fas fa-users w-5 text-lg"></i>
                <span class="font-medium">إدارة الموظفين</span>
            </button>
            
            <button onclick="showSection('forms')" class="nav-btn w-full text-right p-4 rounded-xl transition-all flex items-center space-x-3 space-x-reverse hover:bg-gray-50 dark:hover:bg-gray-700">
                <i class="fas fa-file-alt w-5 text-lg"></i>
                <span class="font-medium">النماذج والتقارير</span>
            </button>
            
            <button onclick="showSection('settings')" class="nav-btn w-full text-right p-4 rounded-xl transition-all flex items-center space-x-3 space-x-reverse hover:bg-gray-50 dark:hover:bg-gray-700">
                <i class="fas fa-cog w-5 text-lg"></i>
                <span class="font-medium">إعدادات النظام</span>
            </button>
            
            <button onclick="showSection('backup')" class="nav-btn w-full text-right p-4 rounded-xl transition-all flex items-center space-x-3 space-x-reverse hover:bg-gray-50 dark:hover:bg-gray-700">
                <i class="fas fa-database w-5 text-lg"></i>
                <span class="font-medium">النسخ الاحتياطي</span>
            </button>
        </nav>

        <!-- Sidebar Footer -->
        <div class="p-4 border-t border-gray-200 dark:border-gray-700">
            <div class="bg-gradient-to-r from-primary to-secondary p-4 rounded-xl text-white text-center">
                <i class="fas fa-shield-alt text-2xl mb-2 block"></i>
                <p class="text-sm font-medium">نظام آمن ومحمي</p>
                <p class="text-xs opacity-90">تشفير البيانات 256-bit</p>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <div class="main-content min-h-screen">
        <!-- Header -->
        <header class="bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700 sticky top-0 z-30">
            <div class="px-4 sm:px-6 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4 space-x-reverse">
                        <button onclick="toggleSidebar()" class="lg:hidden p-2 rounded-lg text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                            <i class="fas fa-bars text-xl"></i>
                        </button>
                        <div>
                            <h1 id="page-title" class="text-xl sm:text-2xl font-bold text-gray-900 dark:text-white">لوحة التحكم</h1>
                            <p id="page-subtitle" class="text-sm text-gray-500 dark:text-gray-400">مرحباً بك في نظام إدارة الموارد البشرية</p>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-3 space-x-reverse">
                        <button onclick="toggleTheme()" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                            <i id="theme-icon" class="fas fa-moon text-gray-600 dark:text-gray-300"></i>
                        </button>
                        
                        <div id="firebase-status" class="hidden sm:flex items-center space-x-2 space-x-reverse bg-green-100 dark:bg-green-900/20 text-green-800 dark:text-green-300 px-3 py-1 rounded-full">
                            <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                            <span class="text-sm font-medium">متصل بـ Firebase</span>
                        </div>
                        
                        <div class="hidden md:block text-sm text-gray-500 dark:text-gray-400" id="current-time"></div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="p-4 sm:p-6">
            <!-- Dashboard Section -->
            <section id="dashboard-section" class="section-content">
                <!-- Stats Cards -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 mb-6 sm:mb-8">
                    <div class="stats-card p-4 sm:p-6 rounded-xl card-shadow animate-fade-in">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600 dark:text-gray-400">إجمالي الموظفين</p>
                                <p id="total-employees" class="text-2xl sm:text-3xl font-bold text-primary">0</p>
                            </div>
                            <div class="w-12 h-12 bg-blue-100 dark:bg-blue-900/20 rounded-xl flex items-center justify-center">
                                <i class="fas fa-users text-blue-600 dark:text-blue-400 text-xl"></i>
                            </div>
                        </div>
                    </div>

                    <div class="stats-card p-4 sm:p-6 rounded-xl card-shadow animate-fade-in">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600 dark:text-gray-400">النماذج المولدة</p>
                                <p id="total-forms" class="text-2xl sm:text-3xl font-bold text-green-600">0</p>
                            </div>
                            <div class="w-12 h-12 bg-green-100 dark:bg-green-900/20 rounded-xl flex items-center justify-center">
                                <i class="fas fa-file-alt text-green-600 dark:text-green-400 text-xl"></i>
                            </div>
                        </div>
                    </div>

                    <div class="stats-card p-4 sm:p-6 rounded-xl card-shadow animate-fade-in">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600 dark:text-gray-400">الإجازات المعلقة</p>
                                <p id="pending-leaves" class="text-2xl sm:text-3xl font-bold text-yellow-600">0</p>
                            </div>
                            <div class="w-12 h-12 bg-yellow-100 dark:bg-yellow-900/20 rounded-xl flex items-center justify-center">
                                <i class="fas fa-clock text-yellow-600 dark:text-yellow-400 text-xl"></i>
                            </div>
                        </div>
                    </div>

                    <div class="stats-card p-4 sm:p-6 rounded-xl card-shadow animate-fade-in">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600 dark:text-gray-400">الموظفين الجدد</p>
                                <p id="new-employees" class="text-2xl sm:text-3xl font-bold text-purple-600">0</p>
                            </div>
                            <div class="w-12 h-12 bg-purple-100 dark:bg-purple-900/20 rounded-xl flex items-center justify-center">
                                <i class="fas fa-user-plus text-purple-600 dark:text-purple-400 text-xl"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions & Recent Activity -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                    <div class="bg-white dark:bg-gray-800 p-6 rounded-xl card-shadow">
                        <h3 class="text-lg font-bold mb-4 text-gray-900 dark:text-white flex items-center">
                            <i class="fas fa-bolt text-primary ml-2"></i>
                            إجراءات سريعة
                        </h3>
                        <div class="space-y-3">
                            <button onclick="showAddEmployeeModal()" class="w-full bg-gradient-to-r from-primary to-secondary hover:from-blue-600 hover:to-purple-600 text-white p-3 rounded-xl transition-all flex items-center justify-center space-x-2 space-x-reverse font-medium">
                                <i class="fas fa-user-plus"></i>
                                <span>إضافة موظف جديد</span>
                            </button>
                            <button onclick="showSection('forms')" class="w-full bg-gradient-to-r from-green-500 to-teal-500 hover:from-green-600 hover:to-teal-600 text-white p-3 rounded-xl transition-all flex items-center justify-center space-x-2 space-x-reverse font-medium">
                                <i class="fas fa-file-plus"></i>
                                <span>إنشاء نموذج جديد</span>
                            </button>
                            <button onclick="exportAllData()" class="w-full bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 text-white p-3 rounded-xl transition-all flex items-center justify-center space-x-2 space-x-reverse font-medium">
                                <i class="fas fa-download"></i>
                                <span>تصدير البيانات</span>
                            </button>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 p-6 rounded-xl card-shadow">
                        <h3 class="text-lg font-bold mb-4 text-gray-900 dark:text-white flex items-center">
                            <i class="fas fa-history text-primary ml-2"></i>
                            النشاط الأخير
                        </h3>
                        <div id="recent-activity" class="space-y-3">
                            <div class="flex items-center space-x-3 space-x-reverse p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                                <div class="flex-1">
                                    <p class="text-sm text-gray-900 dark:text-white">تم تحميل النظام بنجاح</p>
                                    <p class="text-xs text-gray-500 dark:text-gray-400">الآن</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 p-6 rounded-xl card-shadow">
                        <h3 class="text-lg font-bold mb-4 text-gray-900 dark:text-white flex items-center">
                            <i class="fas fa-chart-pie text-primary ml-2"></i>
                            الإحصائيات السريعة
                        </h3>
                        <canvas id="quick-chart" width="300" height="200"></canvas>
                    </div>
                </div>
            </section>

            <!-- Employees Section -->
            <section id="employees-section" class="section-content">
                <div class="bg-white dark:bg-gray-800 rounded-xl card-shadow p-4 sm:p-6 mb-6">
                    <!-- Header -->
                    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between mb-6 space-y-4 lg:space-y-0">
                        <h2 class="text-xl sm:text-2xl font-bold text-gray-900 dark:text-white">إدارة الموظفين</h2>
                        <div class="flex flex-col sm:flex-row gap-3">
                            <button onclick="showAddEmployeeModal()" class="bg-primary hover:bg-blue-600 text-white px-4 py-2.5 rounded-lg transition-all flex items-center justify-center space-x-2 space-x-reverse font-medium">
                                <i class="fas fa-user-plus"></i>
                                <span>إضافة موظف</span>
                            </button>
                            <label class="bg-green-500 hover:bg-green-600 text-white px-4 py-2.5 rounded-lg transition-all cursor-pointer flex items-center justify-center space-x-2 space-x-reverse font-medium">
                                <i class="fas fa-file-import"></i>
                                <span>استيراد Excel</span>
                                <input type="file" id="excel-file" accept=".xlsx,.xls" class="hidden">
                            </label>
                            <button onclick="exportEmployeesToExcel()" class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2.5 rounded-lg transition-all flex items-center justify-center space-x-2 space-x-reverse font-medium">
                                <i class="fas fa-file-export"></i>
                                <span>تصدير Excel</span>
                            </button>
                        </div>
                    </div>

                    <!-- Search and Filter -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                        <div class="input-group">
                            <label>البحث</label>
                            <input type="text" id="search-employees" placeholder="ابحث عن موظف..." class="w-full p-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent transition-all">
                        </div>
                        <div class="input-group">
                            <label>القسم</label>
                            <select id="filter-department" class="w-full p-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent transition-all">
                                <option value="">جميع الأقسام</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>المسمى الوظيفي</label>
                            <select id="filter-position" class="w-full p-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent transition-all">
                                <option value="">جميع المناصب</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>الحالة</label>
                            <select id="filter-status" class="w-full p-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent transition-all">
                                <option value="">جميع الحالات</option>
                                <option value="active">نشط</option>
                                <option value="inactive">غير نشط</option>
                                <option value="on-leave">في إجازة</option>
                            </select>
                        </div>
                    </div>

                    <!-- Employees Table -->
                    <div class="overflow-x-auto">
                        <table class="w-full text-base text-right table-hover">
                            <thead class="bg-gray-50 dark:bg-gray-700">
                                <tr>
                                    <th class="px-4 py-4 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                                        <input type="checkbox" id="select-all-employees" class="rounded border-gray-300">
                                    </th>
                                    <th class="px-4 py-4 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider cursor-pointer hover:text-primary transition-colors" onclick="sortTable('name')">
                                        الاسم <i class="fas fa-sort"></i>
                                    </th>
                                    <th class="px-4 py-4 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider cursor-pointer hover:text-primary transition-colors" onclick="sortTable('employeeId')">
                                        الرقم الوظيفي <i class="fas fa-sort"></i>
                                    </th>
                                    <th class="px-4 py-4 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">المسمى الوظيفي</th>
                                    <th class="px-4 py-4 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">القسم</th>
                                    <th class="px-4 py-4 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">تاريخ التعيين</th>
                                    <th class="px-4 py-4 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">الحالة</th>
                                    <th class="px-4 py-4 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody id="employees-table-body" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                <!-- Employee rows will be inserted here -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Pagination -->
                    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mt-6 space-y-4 sm:space-y-0">
                        <div class="text-sm text-gray-700 dark:text-gray-300">
                            عرض <span id="showing-from">1</span> إلى <span id="showing-to">10</span> من <span id="total-records">0</span> موظف
                        </div>
                        <div class="flex space-x-2 space-x-reverse">
                            <button onclick="previousPage()" id="prev-btn" class="px-3 py-2 text-sm bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 disabled:opacity-50 transition-colors">
                                السابق
                            </button>
                            <div id="page-numbers" class="flex space-x-1 space-x-reverse">
                                <!-- Page numbers will be inserted here -->
                            </div>
                            <button onclick="nextPage()" id="next-btn" class="px-3 py-2 text-sm bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 disabled:opacity-50 transition-colors">
                                التالي
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Forms Section -->
            <section id="forms-section" class="section-content">
                <div class="grid lg:grid-cols-4 gap-6">
                    <!-- Form Selection Panel -->
                    <div class="lg:col-span-1">
                        <div class="bg-white dark:bg-gray-800 rounded-xl card-shadow p-6 sticky top-24">
                            <h3 class="text-xl font-bold mb-6 text-primary flex items-center">
                                <i class="fas fa-cogs ml-2"></i>
                                إعداد النموذج
                            </h3>
                            
                            <div class="space-y-6">
                                <div class="input-group">
                                    <label>اختر الموظف</label>
                                    <select id="employee-select" class="w-full p-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent transition-all">
                                        <option value="">اختر موظف...</option>
                                    </select>
                                </div>

                                <div>
                                    <h4 class="font-semibold mb-4 text-gray-900 dark:text-white">أنواع النماذج</h4>
                                    <div class="space-y-3">
                                        <!-- Form Type Buttons -->
                                        <button onclick="generateForm('start-work')" class="form-type-btn w-full p-4 text-right bg-blue-50 hover:bg-blue-100 dark:bg-blue-900/20 dark:hover:bg-blue-900/40 border border-blue-200 dark:border-blue-800 rounded-lg transition-all">
                                            <div class="flex items-center space-x-3 space-x-reverse">
                                                <i class="fas fa-briefcase text-blue-600 dark:text-blue-400"></i>
                                                <div class="text-right">
                                                    <div class="font-medium">مباشرة عمل</div>
                                                    <div class="text-xs text-gray-500">إشعار بدء الخدمة</div>
                                                </div>
                                            </div>
                                        </button>

                                        <button onclick="generateForm('vacation')" class="form-type-btn w-full p-4 text-right bg-green-50 hover:bg-green-100 dark:bg-green-900/20 dark:hover:bg-green-900/40 border border-green-200 dark:border-green-800 rounded-lg transition-all">
                                            <div class="flex items-center space-x-3 space-x-reverse">
                                                <i class="fas fa-umbrella-beach text-green-600 dark:text-green-400"></i>
                                                <div class="text-right">
                                                    <div class="font-medium">طلب إجازة</div>
                                                    <div class="text-xs text-gray-500">طلب إجازة رسمي</div>
                                                </div>
                                            </div>
                                        </button>

                                        <button onclick="generateForm('salary-certificate')" class="form-type-btn w-full p-4 text-right bg-purple-50 hover:bg-purple-100 dark:bg-purple-900/20 dark:hover:bg-purple-900/40 border border-purple-200 dark:border-purple-800 rounded-lg transition-all">
                                            <div class="flex items-center space-x-3 space-x-reverse">
                                                <i class="fas fa-file-invoice-dollar text-purple-600 dark:text-purple-400"></i>
                                                <div class="text-right">
                                                    <div class="font-medium">شهادة راتب</div>
                                                    <div class="text-xs text-gray-500">إثبات راتب</div>
                                                </div>
                                            </div>
                                        </button>

                                        <button onclick="generateForm('experience-certificate')" class="form-type-btn w-full p-4 text-right bg-indigo-50 hover:bg-indigo-100 dark:bg-indigo-900/20 dark:hover:bg-indigo-900/40 border border-indigo-200 dark:border-indigo-800 rounded-lg transition-all">
                                            <div class="flex items-center space-x-3 space-x-reverse">
                                                <i class="fas fa-medal text-indigo-600 dark:text-indigo-400"></i>
                                                <div class="text-right">
                                                    <div class="font-medium">شهادة خبرة</div>
                                                    <div class="text-xs text-gray-500">إثبات خبرة</div>
                                                </div>
                                            </div>
                                        </button>

                                        <button onclick="generateForm('vacation-unpaid')" class="form-type-btn w-full p-4 text-right bg-orange-50 hover:bg-orange-100 dark:bg-orange-900/20 dark:hover:bg-orange-900/40 border border-orange-200 dark:border-orange-800 rounded-lg transition-all">
                                            <div class="flex items-center space-x-3 space-x-reverse">
                                                <i class="fas fa-pause text-orange-600 dark:text-orange-400"></i>
                                                <div class="text-right">
                                                    <div class="font-medium">إجازة بدون راتب</div>
                                                    <div class="text-xs text-gray-500">طلب إجازة بدون راتب</div>
                                                </div>
                                            </div>
                                        </button>

                                        <button onclick="generateForm('custody-receive')" class="form-type-btn w-full p-4 text-right bg-cyan-50 hover:bg-cyan-100 dark:bg-cyan-900/20 dark:hover:bg-cyan-900/40 border border-cyan-200 dark:border-cyan-800 rounded-lg transition-all">
                                            <div class="flex items-center space-x-3 space-x-reverse">
                                                <i class="fas fa-box text-cyan-600 dark:text-cyan-400"></i>
                                                <div class="text-right">
                                                    <div class="font-medium">استلام عهدة</div>
                                                    <div class="text-xs text-gray-500">محضر استلام العهدات</div>
                                                </div>
                                            </div>
                                        </button>

                                        <button onclick="generateForm('custody-handover')" class="form-type-btn w-full p-4 text-right bg-amber-50 hover:bg-amber-100 dark:bg-amber-900/20 dark:hover:bg-amber-900/40 border border-amber-200 dark:border-amber-800 rounded-lg transition-all">
                                            <div class="flex items-center space-x-3 space-x-reverse">
                                                <i class="fas fa-handshake text-amber-600 dark:text-amber-400"></i>
                                                <div class="text-right">
                                                    <div class="font-medium">تسليم عهدة</div>
                                                    <div class="text-xs text-gray-500">محضر تسليم العهدات</div>
                                                </div>
                                            </div>
                                        </button>

                                        <button onclick="generateForm('service-termination')" class="form-type-btn w-full p-4 text-right bg-gray-50 hover:bg-gray-100 dark:bg-gray-900/20 dark:hover:bg-gray-900/40 border border-gray-200 dark:border-gray-800 rounded-lg transition-all">
                                            <div class="flex items-center space-x-3 space-x-reverse">
                                                <i class="fas fa-user-times text-gray-600 dark:text-gray-400"></i>
                                                <div class="text-right">
                                                    <div class="font-medium">إنهاء الخدمات</div>
                                                    <div class="text-xs text-gray-500">قرار إنهاء الخدمة</div>
                                                </div>
                                            </div>
                                        </button>

                                        <button onclick="generateForm('resignation')" class="form-type-btn w-full p-4 text-right bg-rose-50 hover:bg-rose-100 dark:bg-rose-900/20 dark:hover:bg-rose-900/40 border border-rose-200 dark:border-rose-800 rounded-lg transition-all">
                                            <div class="flex items-center space-x-3 space-x-reverse">
                                                <i class="fas fa-sign-out-alt text-rose-600 dark:text-rose-400"></i>
                                                <div class="text-right">
                                                    <div class="font-medium">الاستقالة</div>
                                                    <div class="text-xs text-gray-500">طلب استقالة</div>
                                                </div>
                                            </div>
                                        </button>
                                    </div>
                                </div>

                                <div class="pt-4 border-t border-gray-200 dark:border-gray-700">
                                    <h4 class="font-semibold mb-3 text-gray-900 dark:text-white">خيارات متقدمة</h4>
                                    <div class="space-y-3">
                                        <label class="flex items-center">
                                            <input type="checkbox" id="include-logo" checked class="rounded border-gray-300 ml-2">
                                            <span class="text-sm">تضمين شعار المدرسة</span>
                                        </label>
                                        <div class="space-y-2">
                                            <label class="text-sm font-medium text-gray-700 dark:text-gray-300">رفع شعار المدرسة</label>
                                            <input type="file" id="logo-upload" accept="image/*" class="w-full text-sm border border-gray-300 dark:border-gray-600 rounded-lg p-2 bg-white dark:bg-gray-700">
                                            <div id="logo-preview" class="mt-2 hidden">
                                                <img id="logo-image" class="logo-preview">
                                            </div>
                                        </div>
                                        <label class="flex items-center">
                                            <input type="checkbox" id="include-watermark" class="rounded border-gray-300 ml-2">
                                            <span class="text-sm">إضافة علامة مائية</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" id="auto-save" checked class="rounded border-gray-300 ml-2">
                                            <span class="text-sm">حفظ تلقائي</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Form Preview -->
                    <div class="lg:col-span-3">
                        <div class="bg-white dark:bg-gray-800 rounded-xl card-shadow p-6">
                            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6 no-print space-y-4 sm:space-y-0">
                                <h3 class="text-xl font-bold text-primary flex items-center">
                                    <i class="fas fa-eye ml-2"></i>
                                    معاينة النموذج
                                </h3>
                                <div class="flex flex-wrap gap-2">
                                    <button onclick="saveForm()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors flex items-center space-x-2 space-x-reverse">
                                        <i class="fas fa-save"></i>
                                        <span>حفظ</span>
                                    </button>
                                    <button onclick="exportToPDF()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors flex items-center space-x-2 space-x-reverse">
                                        <i class="fas fa-file-pdf"></i>
                                        <span>PDF</span>
                                    </button>
                                    <button onclick="printForm()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors flex items-center space-x-2 space-x-reverse">
                                        <i class="fas fa-print"></i>
                                        <span>طباعة</span>
                                    </button>
                                </div>
                            </div>
                            
                            <div id="form-preview" class="min-h-screen">
                                <div class="text-center text-gray-500 dark:text-gray-400 py-20">
                                    <i class="fas fa-file-alt text-6xl mb-4 opacity-50"></i>
                                    <h3 class="text-xl font-medium mb-2">اختر موظف ونوع النموذج</h3>
                                    <p>لعرض المعاينة والبدء في التحرير</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Settings Section -->
            <section id="settings-section" class="section-content">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white dark:bg-gray-800 rounded-xl card-shadow p-6">
                        <h3 class="text-xl font-bold mb-6 text-gray-900 dark:text-white flex items-center">
                            <i class="fas fa-school text-primary ml-2"></i>
                            إعدادات المدرسة
                        </h3>
                        <form id="company-settings-form" class="space-y-4">
                            <div class="input-group">
                                <label>اسم المدرسة</label>
                                <input type="text" id="company-name" class="w-full p-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent transition-all" value="مدرسة الثروات الوطنية الخاصة">
                            </div>
                            <div class="input-group">
                                <label>عنوان المدرسة</label>
                                <textarea id="company-address" rows="3" class="w-full p-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent transition-all">دولة الإمارات العربية المتحدة، أبوظبي، بني ياس شرق 9</textarea>
                            </div>
                            <div class="input-group">
                                <label>رقم الهاتف</label>
                                <input type="tel" id="company-phone" class="w-full p-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent transition-all" value="025551234">
                            </div>
                            <div class="input-group">
                                <label>البريد الإلكتروني</label>
                                <input type="email" id="company-email" class="w-full p-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent transition-all" value="info@alserowat-school.ae">
                            </div>
                            <button type="submit" class="w-full bg-gradient-to-r from-primary to-secondary hover:from-blue-600 hover:to-purple-600 text-white py-3 rounded-lg transition-all font-medium">
                                حفظ الإعدادات
                            </button>
                        </form>
                    </div>

                    <div class="bg-white dark:bg-gray-800 rounded-xl card-shadow p-6">
                        <h3 class="text-xl font-bold mb-6 text-gray-900 dark:text-white flex items-center">
                            <i class="fas fa-cog text-primary ml-2"></i>
                            إعدادات النظام
                        </h3>
                        <div class="space-y-6">
                            <!-- System settings toggles -->
                            <div class="flex items-center justify-between">
                                <div>
                                    <h4 class="font-medium text-gray-900 dark:text-white">التزامن التلقائي</h4>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">مزامنة البيانات مع Firebase</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="auto-sync" checked class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                                </label>
                            </div>

                            <div class="flex items-center justify-between">
                                <div>
                                    <h4 class="font-medium text-gray-900 dark:text-white">التنبيهات</h4>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">تنبيهات النظام والأحداث</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="notifications" checked class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                                </label>
                            </div>

                            <div class="flex items-center justify-between">
                                <div>
                                    <h4 class="font-medium text-gray-900 dark:text-white">النسخ الاحتياطي التلقائي</h4>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">نسخ احتياطي يومي للبيانات</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="auto-backup" checked class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Backup Section -->
            <section id="backup-section" class="section-content">
                <div class="bg-white dark:bg-gray-800 rounded-xl card-shadow p-6">
                    <h3 class="text-xl font-bold mb-6 text-gray-900 dark:text-white flex items-center">
                        <i class="fas fa-database text-primary ml-2"></i>
                        إدارة النسخ الاحتياطية
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                        <div class="space-y-4 p-6 bg-blue-50 dark:bg-blue-900/20 rounded-xl">
                            <h4 class="font-semibold text-gray-900 dark:text-white flex items-center">
                                <i class="fas fa-download text-blue-600 dark:text-blue-400 ml-2"></i>
                                إنشاء نسخة احتياطية
                            </h4>
                            <p class="text-sm text-gray-600 dark:text-gray-400">قم بإنشاء نسخة احتياطية من جميع البيانات</p>
                            <button onclick="createBackup()" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-lg transition-colors flex items-center justify-center space-x-2 space-x-reverse font-medium">
                                <i class="fas fa-download"></i>
                                <span>إنشاء نسخة احتياطية</span>
                            </button>
                        </div>
                        
                        <div class="space-y-4 p-6 bg-green-50 dark:bg-green-900/20 rounded-xl">
                            <h4 class="font-semibold text-gray-900 dark:text-white flex items-center">
                                <i class="fas fa-upload text-green-600 dark:text-green-400 ml-2"></i>
                                استيراد نسخة احتياطية
                            </h4>
                            <p class="text-sm text-gray-600 dark:text-gray-400">استعادة البيانات من نسخة احتياطية</p>
                            <label class="w-full bg-green-500 hover:bg-green-600 text-white py-3 rounded-lg transition-colors cursor-pointer flex items-center justify-center space-x-2 space-x-reverse font-medium">
                                <i class="fas fa-upload"></i>
                                <span>اختيار ملف النسخة الاحتياطية</span>
                                <input type="file" id="backup-file" accept=".json" class="hidden">
                            </label>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Add Employee Modal -->
    <div id="add-employee-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-4xl w-full max-h-screen overflow-y-auto animate-scale-in">
            <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-bold text-primary flex items-center">
                        <i class="fas fa-user-plus ml-2"></i>
                        <span id="modal-title">إضافة موظف جديد</span>
                    </h3>
                    <button onclick="hideEmployeeModal()" class="p-2 rounded-lg text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            <div class="p-6">
                <form id="employee-form" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <input type="hidden" id="employee-id-hidden">
                    <div class="input-group">
                        <label>الاسم الكامل *</label>
                        <input type="text" id="emp-name" required class="w-full p-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent transition-all">
                    </div>
                    <div class="input-group">
                        <label>الرقم الوظيفي *</label>
                        <input type="text" id="emp-id" required class="w-full p-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent transition-all">
                    </div>
                    <div class="input-group">
                        <label>المسمى الوظيفي *</label>
                        <input type="text" id="emp-position" required class="w-full p-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent transition-all">
                    </div>
                    <div class="input-group">
                        <label>القسم *</label>
                        <select id="emp-department" required class="w-full p-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent transition-all">
                            <option value="">اختر القسم</option>
                            <option value="الإدارة">الإدارة</option>
                            <option value="شؤون الطلاب">شؤون الطلاب</option>
                            <option value="المالية">المالية</option>
                            <option value="الخدمات المساندة">الخدمات المساندة</option>
                            <option value="مشرفين الأقسام">مشرفين الأقسام</option>
                            <option value="المعلمين">المعلمين</option>
                            <option value="المنسقين">المنسقين</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>تاريخ التعيين *</label>
                        <input type="date" id="emp-hire-date" required class="w-full p-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent transition-all">
                    </div>
                    <div class="input-group">
                        <label>الراتب الأساسي</label>
                        <input type="number" id="emp-salary" class="w-full p-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent transition-all">
                    </div>
                    <div class="input-group">
                        <label>رقم الهوية الوطنية</label>
                        <input type="text" id="emp-national-id" class="w-full p-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent transition-all">
                    </div>
                    <div class="input-group">
                        <label>البريد الإلكتروني</label>
                        <input type="email" id="emp-email" class="w-full p-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent transition-all">
                    </div>
                    <div class="input-group">
                        <label>رقم الهاتف</label>
                        <input type="tel" id="emp-phone" class="w-full p-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent transition-all">
                    </div>
                    <div class="input-group">
                        <label>الحالة الاجتماعية</label>
                        <select id="emp-marital-status" class="w-full p-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent transition-all">
                            <option value="">اختر الحالة</option>
                            <option value="أعزب">أعزب</option>
                            <option value="متزوج">متزوج</option>
                            <option value="مطلق">مطلق</option>
                            <option value="أرمل">أرمل</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>تاريخ الميلاد</label>
                        <input type="date" id="emp-birth-date" class="w-full p-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent transition-all">
                    </div>
                    <div class="input-group md:col-span-2">
                        <label>العنوان</label>
                        <textarea id="emp-address" rows="3" class="w-full p-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent transition-all"></textarea>
                    </div>
                    <div class="md:col-span-2 flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-3 sm:space-x-reverse pt-4">
                        <button type="submit" id="submit-btn" class="flex-1 bg-gradient-to-r from-primary to-secondary hover:from-blue-600 hover:to-purple-600 text-white py-3 rounded-lg transition-all font-medium flex items-center justify-center space-x-2 space-x-reverse">
                            <i class="fas fa-save"></i>
                            <span>حفظ الموظف</span>
                        </button>
                        <button type="button" onclick="hideEmployeeModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 rounded-lg transition-all font-medium flex items-center justify-center space-x-2 space-x-reverse">
                            <i class="fas fa-times"></i>
                            <span>إلغاء</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- View Employee Modal -->
    <div id="view-employee-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-4xl w-full max-h-screen overflow-y-auto animate-scale-in">
            <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-bold text-primary flex items-center">
                        <i class="fas fa-eye ml-2"></i>
                        تفاصيل الموظف
                    </h3>
                    <button onclick="hideViewEmployeeModal()" class="p-2 rounded-lg text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            <div class="p-6">
                <div id="employee-details" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Employee details will be populated here -->
                </div>
                <div class="mt-6 flex justify-end space-x-3 space-x-reverse">
                    <button onclick="editEmployeeFromView()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors flex items-center space-x-2 space-x-reverse">
                        <i class="fas fa-edit"></i>
                        <span>تعديل</span>
                    </button>
                    <button onclick="hideViewEmployeeModal()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors">
                        إغلاق
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notifications Container -->
    <div id="notifications-container" class="fixed top-4 left-4 z-50 space-y-4"></div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBy-QbPeE3e3uIAIoNouQ_HTkQ5fcx5Ibs",
            authDomain: "make-forms-b2eb1.firebaseapp.com",
            projectId: "make-forms-b2eb1",
            storageBucket: "make-forms-b2eb1.firebasestorage.app",
            messagingSenderId: "138837621965",
            appId: "1:138837621965:web:763e2c314c7cf60b22bd84",
            measurementId: "G-8R4PVR30GH"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();

        // Global Variables
        let employees = [];
        let filteredEmployees = [];
        let currentEmployee = null;
        let currentEmployeeId = null;
        let currentPage = 1;
        const itemsPerPage = 10;
        let sortDirection = 'asc';
        let sortColumn = 'name';
        let generatedForms = 0;
        let charts = {};
        let companyLogo = null;
        let isEditMode = false;

        // Firebase Functions
        async function loadEmployeesFromFirebase() {
            try {
                showNotification('جاري تحميل البيانات من Firebase...', 'info');
                const snapshot = await db.collection('employees').orderBy('createdAt', 'desc').get();
                employees = [];
                snapshot.forEach(doc => {
                    employees.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                
                filteredEmployees = [...employees];
                updateEmployeesTable();
                updateEmployeeSelect();
                updateDashboardStats();
                updateFilters();
                showNotification('تم تحميل البيانات بنجاح من Firebase', 'success');
                
                // Update Firebase status
                const firebaseStatus = document.getElementById('firebase-status');
                if (firebaseStatus) {
                    firebaseStatus.classList.remove('hidden');
                }
                
            } catch (error) {
                console.error('Error loading employees:', error);
                showNotification('خطأ في تحميل البيانات من Firebase', 'error');
            }
        }

        async function saveEmployeeToFirebase(employee) {
            try {
                if (employee.id) {
                    // Update existing employee
                    await db.collection('employees').doc(employee.id).update({
                        ...employee,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    showNotification('تم تحديث بيانات الموظف في Firebase', 'success');
                } else {
                    // Add new employee
                    const docRef = await db.collection('employees').add({
                        ...employee,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    employee.id = docRef.id;
                    showNotification('تم حفظ الموظف في Firebase', 'success');
                }
                return employee;
            } catch (error) {
                console.error('Error saving employee:', error);
                showNotification('خطأ في حفظ البيانات في Firebase', 'error');
                throw error;
            }
        }

        async function deleteEmployeeFromFirebase(employeeId) {
            try {
                await db.collection('employees').doc(employeeId).delete();
                showNotification('تم حذف الموظف من Firebase', 'success');
            } catch (error) {
                console.error('Error deleting employee:', error);
                showNotification('خطأ في حذف الموظف من Firebase', 'error');
                throw error;
            }
        }

        // Theme Management
        function initializeTheme() {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
                document.getElementById('theme-icon').className = 'fas fa-sun text-gray-600 dark:text-gray-300';
            }
            
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                if (event.matches) {
                    document.documentElement.classList.add('dark');
                    document.getElementById('theme-icon').className = 'fas fa-sun text-gray-600 dark:text-gray-300';
                } else {
                    document.documentElement.classList.remove('dark');
                    document.getElementById('theme-icon').className = 'fas fa-moon text-gray-600 dark:text-gray-300';
                }
            });
        }

        function toggleTheme() {
            const isDark = document.documentElement.classList.contains('dark');
            if (isDark) {
                document.documentElement.classList.remove('dark');
                document.getElementById('theme-icon').className = 'fas fa-moon text-gray-600 dark:text-gray-300';
            } else {
                document.documentElement.classList.add('dark');
                document.getElementById('theme-icon').className = 'fas fa-sun text-gray-600 dark:text-gray-300';
            }
        }

        // Logo Upload Handler
        function initializeLogoUpload() {
            const logoUpload = document.getElementById('logo-upload');
            if (logoUpload) {
                logoUpload.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file && file.type.startsWith('image/')) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            companyLogo = e.target.result;
                            const logoPreview = document.getElementById('logo-preview');
                            const logoImage = document.getElementById('logo-image');
                            logoImage.src = companyLogo;
                            logoPreview.classList.remove('hidden');
                            showNotification('تم رفع الشعار بنجاح', 'success');
                        };
                        reader.readAsDataURL(file);
                    } else {
                        showNotification('يرجى اختيار ملف صورة صحيح', 'error');
                    }
                });
            }
        }

        // Sidebar Management
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            
            if (sidebar.classList.contains('open')) {
                sidebar.classList.remove('open');
                overlay.classList.remove('active');
            } else {
                sidebar.classList.add('open');
                overlay.classList.add('active');
            }
        }

        // Section Management
        function showSection(sectionName) {
            document.querySelectorAll('.section-content').forEach(section => {
                section.classList.remove('active');
            });
            
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            const section = document.getElementById(sectionName + '-section');
            if (section) {
                setTimeout(() => {
                    section.classList.add('active');
                }, 100);
            }
            
            const titles = {
                'dashboard': { title: 'لوحة التحكم', subtitle: 'نظرة عامة على النظام' },
                'employees': { title: 'إدارة الموظفين', subtitle: 'إضافة وتعديل بيانات الموظفين' },
                'forms': { title: 'النماذج والتقارير', subtitle: 'إنشاء وإدارة النماذج الرسمية' },
                'settings': { title: 'إعدادات النظام', subtitle: 'تخصيص إعدادات النظام والمدرسة' },
                'backup': { title: 'النسخ الاحتياطي', subtitle: 'إدارة النسخ الاحتياطية للبيانات' }
            };
            
            if (titles[sectionName]) {
                document.getElementById('page-title').textContent = titles[sectionName].title;
                document.getElementById('page-subtitle').textContent = titles[sectionName].subtitle;
            }
            
            const navBtn = document.querySelector(`[onclick="showSection('${sectionName}')"]`);
            if (navBtn) {
                navBtn.classList.add('active');
            }
            
            if (window.innerWidth < 1024) {
                toggleSidebar();
            }
        }

        // Employee Management
        function showAddEmployeeModal() {
            isEditMode = false;
            currentEmployeeId = null;
            document.getElementById('modal-title').textContent = 'إضافة موظف جديد';
            document.getElementById('submit-btn').innerHTML = '<i class="fas fa-save"></i><span>حفظ الموظف</span>';
            document.getElementById('add-employee-modal').classList.remove('hidden');
            document.getElementById('emp-hire-date').value = new Date().toISOString().split('T')[0];
            resetEmployeeForm();
        }

        function showEditEmployeeModal(employeeData) {
            isEditMode = true;
            currentEmployeeId = employeeData.id;
            document.getElementById('modal-title').textContent = 'تعديل بيانات الموظف';
            document.getElementById('submit-btn').innerHTML = '<i class="fas fa-save"></i><span>تحديث البيانات</span>';
            
            // Fill form with employee data
            document.getElementById('employee-id-hidden').value = employeeData.id || '';
            document.getElementById('emp-name').value = employeeData.name || '';
            document.getElementById('emp-id').value = employeeData.employeeId || '';
            document.getElementById('emp-position').value = employeeData.position || '';
            document.getElementById('emp-department').value = employeeData.department || '';
            document.getElementById('emp-hire-date').value = employeeData.hireDate || '';
            document.getElementById('emp-salary').value = employeeData.salary || '';
            document.getElementById('emp-national-id').value = employeeData.nationalId || '';
            document.getElementById('emp-email').value = employeeData.email || '';
            document.getElementById('emp-phone').value = employeeData.phone || '';
            document.getElementById('emp-marital-status').value = employeeData.maritalStatus || '';
            document.getElementById('emp-birth-date').value = employeeData.birthDate || '';
            document.getElementById('emp-address').value = employeeData.address || '';
            
            document.getElementById('add-employee-modal').classList.remove('hidden');
        }

        function resetEmployeeForm() {
            document.getElementById('employee-form').reset();
            document.getElementById('employee-id-hidden').value = '';
        }

        function hideEmployeeModal() {
            document.getElementById('add-employee-modal').classList.add('hidden');
            resetEmployeeForm();
            isEditMode = false;
            currentEmployeeId = null;
        }

        // Employee Details View
        function showViewEmployeeModal(employeeData) {
            const modal = document.getElementById('view-employee-modal');
            const detailsContainer = document.getElementById('employee-details');
            
            // Store current employee for editing
            currentEmployee = employeeData;
            
            detailsContainer.innerHTML = `
                <div class="space-y-4">
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                        <h4 class="font-semibold text-gray-900 dark:text-white mb-3">المعلومات الأساسية</h4>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div><span class="font-medium">الاسم:</span> ${employeeData.name || 'غير محدد'}</div>
                            <div><span class="font-medium">الرقم الوظيفي:</span> ${employeeData.employeeId || 'غير محدد'}</div>
                            <div><span class="font-medium">المسمى الوظيفي:</span> ${employeeData.position || 'غير محدد'}</div>
                            <div><span class="font-medium">القسم:</span> ${employeeData.department || 'غير محدد'}</div>
                        </div>
                    </div>
                </div>
                <div class="space-y-4">
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                        <h4 class="font-semibold text-gray-900 dark:text-white mb-3">معلومات الوظيفة</h4>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div><span class="font-medium">تاريخ التعيين:</span> ${formatDateForDisplay(employeeData.hireDate) || 'غير محدد'}</div>
                            <div><span class="font-medium">الراتب الأساسي:</span> ${employeeData.salary ? employeeData.salary + ' درهم' : 'غير محدد'}</div>
                            <div><span class="font-medium">سنوات الخدمة:</span> ${calculateExperience(employeeData.hireDate)}</div>
                            <div><span class="font-medium">الحالة:</span> 
                                <span class="px-2 py-1 text-xs rounded-full ${employeeData.status === 'active' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                    ${employeeData.status === 'active' ? 'نشط' : 'غير نشط'}
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                        <h4 class="font-semibold text-gray-900 dark:text-white mb-3">المعلومات الشخصية</h4>
                        <div class="grid grid-cols-1 gap-4 text-sm">
                            <div><span class="font-medium">رقم الهوية:</span> ${employeeData.nationalId || 'غير محدد'}</div>
                            <div><span class="font-medium">البريد الإلكتروني:</span> ${employeeData.email || 'غير محدد'}</div>
                            <div><span class="font-medium">رقم الهاتف:</span> ${employeeData.phone || 'غير محدد'}</div>
                            <div><span class="font-medium">تاريخ الميلاد:</span> ${formatDateForDisplay(employeeData.birthDate) || 'غير محدد'}</div>
                            <div><span class="font-medium">الحالة الاجتماعية:</span> ${employeeData.maritalStatus || 'غير محدد'}</div>
                            <div><span class="font-medium">العنوان:</span> ${employeeData.address || 'غير محدد'}</div>
                        </div>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
        }

        function hideViewEmployeeModal() {
            document.getElementById('view-employee-modal').classList.add('hidden');
        }

        function editEmployeeFromView() {
            hideViewEmployeeModal();
            if (currentEmployee) {
                showEditEmployeeModal(currentEmployee);
            }
        }

        // Form submission
        function initializeEmployeeForm() {
            const form = document.getElementById('employee-form');
            if (form) {
                form.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const employee = {
                        name: document.getElementById('emp-name').value,
                        employeeId: document.getElementById('emp-id').value,
                        position: document.getElementById('emp-position').value,
                        department: document.getElementById('emp-department').value,
                        hireDate: document.getElementById('emp-hire-date').value,
                        salary: document.getElementById('emp-salary').value || '',
                        nationalId: document.getElementById('emp-national-id').value,
                        email: document.getElementById('emp-email').value,
                        phone: document.getElementById('emp-phone').value,
                        maritalStatus: document.getElementById('emp-marital-status').value,
                        birthDate: document.getElementById('emp-birth-date').value,
                        address: document.getElementById('emp-address').value,
                        status: 'active'
                    };

                    // Add id if editing
                    if (isEditMode && currentEmployeeId) {
                        employee.id = currentEmployeeId;
                    }

                    // Validate required fields
                    if (!employee.name || !employee.employeeId || !employee.position || !employee.department || !employee.hireDate) {
                        showNotification('يرجى ملء جميع الحقول المطلوبة', 'error');
                        return;
                    }

                    // Check for duplicate employee ID (only for new employees or changed IDs)
                    const existingEmployee = employees.find(emp => emp.employeeId === employee.employeeId);
                    if (existingEmployee && (!isEditMode || existingEmployee.id !== currentEmployeeId)) {
                        showNotification('الرقم الوظيفي موجود مسبقاً', 'error');
                        return;
                    }

                    try {
                        showNotification(isEditMode ? 'جاري تحديث البيانات...' : 'جاري حفظ البيانات...', 'info');
                        
                        // Save to Firebase
                        const savedEmployee = await saveEmployeeToFirebase(employee);
                        
                        // Update local array
                        if (isEditMode) {
                            const index = employees.findIndex(emp => emp.id === currentEmployeeId);
                            if (index !== -1) {
                                employees[index] = savedEmployee;
                            }
                        } else {
                            employees.unshift(savedEmployee);
                        }
                        
                        updateEmployeesTable();
                        updateEmployeeSelect();
                        updateDashboardStats();
                        updateFilters();
                        hideEmployeeModal();
                        
                        showNotification(isEditMode ? 'تم تحديث بيانات الموظف بنجاح' : 'تم إضافة الموظف بنجاح', 'success');
                        addToActivityLog(isEditMode ? 'تم تحديث بيانات الموظف: ' + employee.name : 'تم إضافة موظف جديد: ' + employee.name);
                        
                    } catch (error) {
                        console.error('Error saving employee:', error);
                        showNotification('حدث خطأ في حفظ البيانات', 'error');
                    }
                });
            }
        }

        // Excel Import
        function initializeExcelImport() {
            const excelFile = document.getElementById('excel-file');
            if (excelFile) {
                excelFile.addEventListener('change', function(e) {
                    if (e.target.files.length > 0) {
                        importExcel();
                    }
                });
            }
        }

        function importExcel() {
            const file = document.getElementById('excel-file').files[0];
            if (!file) {
                showNotification('يرجى اختيار ملف Excel', 'error');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, {type: 'array'});
                    const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet);
                    
                    processImportedData(jsonData);
                } catch (error) {
                    console.error('Error reading Excel file:', error);
                    showNotification('خطأ في قراءة ملف Excel', 'error');
                }
            };
            reader.readAsArrayBuffer(file);
        }

        async function processImportedData(data) {
            try {
                let successCount = 0;
                let errorCount = 0;

                showNotification('جاري استيراد البيانات...', 'info');

                for (const row of data) {
                    const employee = {
                        name: row['الاسم'] || row['Name'] || '',
                        employeeId: row['الرقم الوظيفي'] || row['Employee ID'] || '',
                        position: row['المسمى الوظيفي'] || row['Position'] || '',
                        department: row['القسم'] || row['Department'] || '',
                        hireDate: row['تاريخ التعيين'] || row['Hire Date'] || '',
                        salary: row['الراتب'] || row['Salary'] || '',
                        nationalId: row['رقم الهوية'] || row['National ID'] || '',
                        email: row['البريد الإلكتروني'] || row['Email'] || '',
                        phone: row['رقم الهاتف'] || row['Phone'] || '',
                        maritalStatus: row['الحالة الاجتماعية'] || row['Marital Status'] || '',
                        birthDate: row['تاريخ الميلاد'] || row['Birth Date'] || '',
                        address: row['العنوان'] || row['Address'] || '',
                        status: 'active'
                    };

                    if (employee.name && employee.employeeId && !employees.some(emp => emp.employeeId === employee.employeeId)) {
                        try {
                            const savedEmployee = await saveEmployeeToFirebase(employee);
                            employees.unshift(savedEmployee);
                            successCount++;
                        } catch (error) {
                            console.error('Error saving employee:', error);
                            errorCount++;
                        }
                    } else {
                        errorCount++;
                    }
                }

                updateEmployeesTable();
                updateEmployeeSelect();
                updateDashboardStats();
                updateFilters();
                showNotification(`تم استيراد ${successCount} موظف بنجاح${errorCount > 0 ? `، فشل في ${errorCount} موظف` : ''}`, 'success');
                addToActivityLog(`تم استيراد ${successCount} موظف من ملف Excel`);
            } catch (error) {
                console.error('Error importing data:', error);
                showNotification('حدث خطأ في استيراد البيانات', 'error');
            }
        }

        // Export to Excel
        function exportEmployeesToExcel() {
            const data = employees.map(emp => ({
                'الاسم': emp.name,
                'الرقم الوظيفي': emp.employeeId,
                'المسمى الوظيفي': emp.position,
                'القسم': emp.department,
                'تاريخ التعيين': formatDateForDisplay(emp.hireDate),
                'الراتب': emp.salary,
                'رقم الهوية': emp.nationalId,
                'البريد الإلكتروني': emp.email,
                'رقم الهاتف': emp.phone,
                'الحالة الاجتماعية': emp.maritalStatus,
                'تاريخ الميلاد': formatDateForDisplay(emp.birthDate),
                'العنوان': emp.address,
                'الحالة': emp.status === 'active' ? 'نشط' : 'غير نشط'
            }));

            const worksheet = XLSX.utils.json_to_sheet(data);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, 'الموظفين');
            
            XLSX.writeFile(workbook, `موظفين_${new Date().toISOString().split('T')[0]}.xlsx`);
            showNotification('تم تصدير البيانات بنجاح', 'success');
        }

        // Search and Filter
        function initializeFilters() {
            const searchInput = document.getElementById('search-employees');
            const filterDept = document.getElementById('filter-department');
            const filterPos = document.getElementById('filter-position');
            const filterStatus = document.getElementById('filter-status');

            if (searchInput) searchInput.addEventListener('input', filterEmployees);
            if (filterDept) filterDept.addEventListener('change', filterEmployees);
            if (filterPos) filterPos.addEventListener('change', filterEmployees);
            if (filterStatus) filterStatus.addEventListener('change', filterEmployees);
        }

        function filterEmployees() {
            const searchTerm = document.getElementById('search-employees')?.value.toLowerCase() || '';
            const departmentFilter = document.getElementById('filter-department')?.value || '';
            const positionFilter = document.getElementById('filter-position')?.value || '';
            const statusFilter = document.getElementById('filter-status')?.value || '';

            filteredEmployees = employees.filter(employee => {
                const matchesSearch = employee.name.toLowerCase().includes(searchTerm) ||
                                    employee.employeeId.toLowerCase().includes(searchTerm) ||
                                    employee.position.toLowerCase().includes(searchTerm);
                const matchesDepartment = !departmentFilter || employee.department === departmentFilter;
                const matchesPosition = !positionFilter || employee.position === positionFilter;
                const matchesStatus = !statusFilter || employee.status === statusFilter;

                return matchesSearch && matchesDepartment && matchesPosition && matchesStatus;
            });

            currentPage = 1;
            updateEmployeesTable();
        }

        // Table sorting
        function sortTable(column) {
            if (sortColumn === column) {
                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                sortColumn = column;
                sortDirection = 'asc';
            }

            filteredEmployees.sort((a, b) => {
                let aValue = a[column] || '';
                let bValue = b[column] || '';
                
                if (typeof aValue === 'string') {
                    aValue = aValue.toLowerCase();
                    bValue = bValue.toLowerCase();
                }

                if (sortDirection === 'asc') {
                    return aValue > bValue ? 1 : -1;
                } else {
                    return aValue < bValue ? 1 : -1;
                }
            });

            updateEmployeesTable();
        }

        // Pagination
        function nextPage() {
            const totalPages = Math.ceil(filteredEmployees.length / itemsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                updateEmployeesTable();
            }
        }

        function previousPage() {
            if (currentPage > 1) {
                currentPage--;
                updateEmployeesTable();
            }
        }

        function goToPage(page) {
            currentPage = page;
            updateEmployeesTable();
        }

        // Update UI functions
        function updateEmployeesTable() {
            const tbody = document.getElementById('employees-table-body');
            if (!tbody) return;
            
            tbody.innerHTML = '';

            const dataToShow = filteredEmployees.length > 0 ? filteredEmployees : employees;
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageData = dataToShow.slice(startIndex, endIndex);

            pageData.forEach((employee) => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 dark:hover:bg-gray-700 transition-all';
                
                const statusClass = employee.status === 'active' ? 'bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-300' :
                                  employee.status === 'on-leave' ? 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-300' :
                                  'bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-300';
                
                const statusText = employee.status === 'active' ? 'نشط' :
                                 employee.status === 'on-leave' ? 'في إجازة' : 'غير نشط';

                row.innerHTML = `
                    <td class="px-4 py-4">
                        <input type="checkbox" class="employee-checkbox rounded border-gray-300" value="${employee.id}">
                    </td>
                    <td class="px-4 py-4 font-medium text-gray-900 dark:text-white">
                        <div class="flex items-center space-x-3 space-x-reverse">
                            <div class="w-8 h-8 bg-gradient-to-br from-primary to-secondary text-white rounded-full flex items-center justify-center text-sm font-bold">
                                ${employee.name.charAt(0)}
                            </div>
                            <span>${employee.name}</span>
                        </div>
                    </td>
                    <td class="px-4 py-4 text-gray-900 dark:text-gray-300">${employee.employeeId}</td>
                    <td class="px-4 py-4 text-gray-900 dark:text-gray-300">${employee.position}</td>
                    <td class="px-4 py-4 text-gray-900 dark:text-gray-300">${employee.department}</td>
                    <td class="px-4 py-4 text-gray-900 dark:text-gray-300">${formatDateForDisplay(employee.hireDate)}</td>
                    <td class="px-4 py-4">
                        <span class="px-2 py-1 text-xs rounded-full ${statusClass}">${statusText}</span>
                    </td>
                    <td class="px-4 py-4">
                        <div class="flex space-x-2 space-x-reverse">
                            <button onclick="editEmployee('${employee.id}')" class="text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 p-2 rounded-lg hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-all" title="تعديل">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteEmployee('${employee.id}')" class="text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300 p-2 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 transition-all" title="حذف">
                                <i class="fas fa-trash"></i>
                            </button>
                            <button onclick="viewEmployee('${employee.id}')" class="text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-300 p-2 rounded-lg hover:bg-green-50 dark:hover:bg-green-900/20 transition-all" title="عرض">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });

            updatePagination(dataToShow.length);
        }

        function updatePagination(totalItems) {
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            const startItem = (currentPage - 1) * itemsPerPage + 1;
            const endItem = Math.min(currentPage * itemsPerPage, totalItems);

            const showingFrom = document.getElementById('showing-from');
            const showingTo = document.getElementById('showing-to');
            const totalRecords = document.getElementById('total-records');

            if (showingFrom) showingFrom.textContent = startItem;
            if (showingTo) showingTo.textContent = endItem;
            if (totalRecords) totalRecords.textContent = totalItems;

            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            
            if (prevBtn) prevBtn.disabled = currentPage === 1;
            if (nextBtn) nextBtn.disabled = currentPage === totalPages;

            const pageNumbers = document.getElementById('page-numbers');
            if (pageNumbers) {
                pageNumbers.innerHTML = '';

                const maxPagesToShow = 5;
                let startPage = Math.max(1, currentPage - Math.floor(maxPagesToShow / 2));
                let endPage = Math.min(totalPages, startPage + maxPagesToShow - 1);

                if (endPage - startPage < maxPagesToShow - 1) {
                    startPage = Math.max(1, endPage - maxPagesToShow + 1);
                }

                for (let i = startPage; i <= endPage; i++) {
                    const pageBtn = document.createElement('button');
                    pageBtn.textContent = i;
                    pageBtn.className = `px-3 py-2 text-sm rounded-lg transition-colors ${i === currentPage ? 'bg-primary text-white' : 'bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600'}`;
                    pageBtn.onclick = () => goToPage(i);
                    pageNumbers.appendChild(pageBtn);
                }
            }
        }

        function updateEmployeeSelect() {
            const select = document.getElementById('employee-select');
            if (!select) return;
            
            select.innerHTML = '<option value="">اختر موظف...</option>';

            employees.forEach((employee) => {
                const option = document.createElement('option');
                option.value = employee.id;
                option.textContent = `${employee.name} - ${employee.employeeId}`;
                select.appendChild(option);
            });
        }

        function updateFilters() {
            const departments = [...new Set(employees.map(emp => emp.department))].filter(Boolean);
            const positions = [...new Set(employees.map(emp => emp.position))].filter(Boolean);

            updateSelectOptions('filter-department', departments);
            updateSelectOptions('filter-position', positions);
        }

        function updateSelectOptions(selectId, options) {
            const select = document.getElementById(selectId);
            if (!select) return;
            
            const currentValue = select.value;
            
            const firstOption = select.children[0];
            select.innerHTML = '';
            select.appendChild(firstOption);

            options.forEach(option => {
                const optionElement = document.createElement('option');
                optionElement.value = option;
                optionElement.textContent = option;
                select.appendChild(optionElement);
            });

            select.value = currentValue;
        }

        function updateDashboardStats() {
            const totalEmployees = document.getElementById('total-employees');
            const totalForms = document.getElementById('total-forms');
            const newEmployees = document.getElementById('new-employees');
            
            if (totalEmployees) totalEmployees.textContent = employees.length;
            if (totalForms) totalForms.textContent = generatedForms;
            
            if (newEmployees) {
                const newEmployeesCount = employees.filter(emp => {
                    const hireDate = new Date(emp.hireDate);
                    const thirtyDaysAgo = new Date();
                    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                    return hireDate >= thirtyDaysAgo;
                }).length;
                newEmployees.textContent = newEmployeesCount;
            }
        }

        // Employee actions
        function editEmployee(employeeId) {
            const employee = employees.find(emp => emp.id === employeeId);
            if (employee) {
                showEditEmployeeModal(employee);
            }
        }

        function deleteEmployee(employeeId) {
            const employee = employees.find(emp => emp.id === employeeId);
            if (!employee) return;
            
            showConfirmDialog(
                `هل أنت متأكد من حذف الموظف "${employee.name}"؟ هذا الإجراء لا يمكن التراجع عنه.`,
                async () => {
                    try {
                        showNotification('جاري حذف البيانات...', 'info');
                        
                        // Delete from Firebase
                        await deleteEmployeeFromFirebase(employeeId);
                        
                        // Update local array
                        employees = employees.filter(emp => emp.id !== employeeId);
                        filteredEmployees = filteredEmployees.filter(emp => emp.id !== employeeId);
                        
                        updateEmployeesTable();
                        updateEmployeeSelect();
                        updateDashboardStats();
                        updateFilters();
                        
                        showNotification('تم حذف الموظف بنجاح', 'success');
                        addToActivityLog('تم حذف الموظف: ' + employee.name);
                    } catch (error) {
                        console.error('Error deleting employee:', error);
                        showNotification('حدث خطأ في حذف الموظف', 'error');
                    }
                }
            );
        }

        function viewEmployee(employeeId) {
            const employee = employees.find(emp => emp.id === employeeId);
            if (employee) {
                showViewEmployeeModal(employee);
            }
        }

        // Form Generation Functions
        function generateForm(formType) {
            const selectedId = document.getElementById('employee-select')?.value;
            if (!selectedId) {
                showNotification('يرجى اختيار موظف أولاً', 'error');
                return;
            }

            currentEmployee = employees.find(emp => emp.id === selectedId);
            if (!currentEmployee) {
                showNotification('الموظف المحدد غير موجود', 'error');
                return;
            }

            const preview = document.getElementById('form-preview');
            
            switch(formType) {
                case 'start-work':
                    preview.innerHTML = generateStartWorkForm(currentEmployee);
                    break;
                case 'vacation':
                    preview.innerHTML = generateVacationForm(currentEmployee);
                    break;
                case 'salary-certificate':
                    preview.innerHTML = generateSalaryCertificateForm(currentEmployee);
                    break;
                case 'experience-certificate':
                    preview.innerHTML = generateExperienceCertificateForm(currentEmployee);
                    break;
                case 'vacation-unpaid':
                    preview.innerHTML = generateUnpaidVacationForm(currentEmployee);
                    break;
                case 'custody-receive':
                    preview.innerHTML = generateCustodyReceiveForm(currentEmployee);
                    break;
                case 'custody-handover':
                    preview.innerHTML = generateCustodyHandoverForm(currentEmployee);
                    break;
                case 'service-termination':
                    preview.innerHTML = generateServiceTerminationForm(currentEmployee);
                    break;
                case 'resignation':
                    preview.innerHTML = generateResignationForm(currentEmployee);
                    break;
            }

            generatedForms++;
            updateDashboardStats();
            addToActivityLog(`تم إنشاء نموذج ${getFormTypeName(formType)} للموظف ${currentEmployee.name}`);
        }

        function getFormTypeName(formType) {
            const names = {
                'start-work': 'مباشرة عمل',
                'vacation': 'طلب إجازة',
                'salary-certificate': 'شهادة راتب',
                'experience-certificate': 'شهادة خبرة',
                'vacation-unpaid': 'إجازة بدون راتب',
                'custody-receive': 'استلام عهدة',
                'custody-handover': 'تسليم عهدة',
                'service-termination': 'إنهاء الخدمات',
                'resignation': 'الاستقالة'
            };
            return names[formType] || formType;
        }

        // Enhanced Form Templates Helper Functions
        function generateFormHeader(companyName, companyAddress) {
            const logoHtml = companyLogo ? 
                `<img src="${companyLogo}" class="company-logo">` : 
                `<div class="w-8 h-8 bg-gradient-to-r from-primary to-secondary rounded-full flex items-center justify-center ml-2">
                    <i class="fas fa-graduation-cap text-white text-xs"></i>
                 </div>`;
            
            return `
                <div class="company-header">
                    ${logoHtml}
                    <div class="company-info">
                        <div class="company-name">${companyName}</div>
                        <div class="company-address">${companyAddress || ''}</div>
                    </div>
                </div>
            `;
        }

        function generateInfoField(label, value) {
            return `
                <div class="form-info-field">
                    <span class="label">${label}:</span>
                    <span class="value">${value || 'غير محدد'}</span>
                </div>
            `;
        }

        function generateEditableField(label, value = '') {
            return `
                <div>
                    <label class="block text-xs font-medium text-gray-700 mb-1">${label}</label>
                    <div class="editable-field">${value}</div>
                </div>
            `;
        }

        function generateCheckbox(label) {
            return `
                <div class="checkbox-item">
                    <input type="checkbox" class="rounded border-gray-300">
                    <span>${label}</span>
                </div>
            `;
        }

        function generateFormFooter(showApprovals = false) {
            const gridClass = showApprovals ? 'signature-grid' : 'signature-grid-2';
            const approvalSection = showApprovals ? `
                <div class="signature-section">
                    <div class="mb-2 font-semibold text-gray-800 text-xs">توقيع المدير المباشر</div>
                    <div class="signature-line"></div>
                    <div class="text-xs text-gray-600">التاريخ: _______</div>
                </div>
            ` : '';
            
            return `
                <div class="form-footer">
                    <div class="${gridClass}">
                        <div class="signature-section">
                            <div class="mb-2 font-semibold text-gray-800 text-xs">توقيع الموظف</div>
                            <div class="signature-line"></div>
                            <div class="text-xs text-gray-600">التاريخ: _______</div>
                        </div>
                        ${approvalSection}
                        <div class="signature-section">
                            <div class="mb-2 font-semibold text-gray-800 text-xs">اعتماد الموارد البشرية</div>
                            <div class="signature-line"></div>
                            <div class="text-xs text-gray-600">التاريخ: _______</div>
                        </div>
                    </div>
                    
                    <div class="text-center mt-4">
                        <div class="official-seal">الختم الرسمي</div>
                    </div>
                </div>
            `;
        }

        // Enhanced Compact Form Generation Functions for A4
        function generateStartWorkForm(employee) {
            const companyName = document.getElementById('company-name')?.value || 'مدرسة الثروات الوطنية الخاصة';
            const companyAddress = document.getElementById('company-address')?.value || 'دولة الإمارات العربية المتحدة، أبوظبي، بني ياس شرق 9';
            
            return `
                <div class="form-template">
                    ${generateFormHeader(companyName, companyAddress)}
                    
                    <div class="form-header">
                        <h1 class="form-title">إشعار مباشرة عمل</h1>
                        <p class="form-subtitle">إشعار رسمي ببدء الخدمة</p>
                        <div class="form-subtitle">رقم المستند: SW-${employee.employeeId}-${new Date().getFullYear()}</div>
                    </div>

                    <div class="form-content">
                        <div class="form-content-grid">
                            <div class="space-y-1">
                                ${generateInfoField('الاسم الكامل', employee.name)}
                                ${generateInfoField('الرقم الوظيفي', employee.employeeId)}
                                ${generateInfoField('المسمى الوظيفي', employee.position)}
                                ${generateInfoField('القسم', employee.department)}
                            </div>
                            <div class="space-y-1">
                                ${generateInfoField('تاريخ المباشرة', formatDateForDisplay(employee.hireDate))}
                                ${generateInfoField('تاريخ الإصدار', formatDateForDisplay(new Date()))}
                                ${generateInfoField('رقم الهوية', employee.nationalId)}
                                ${generateInfoField('الراتب الأساسي', employee.salary ? employee.salary + ' درهم' : 'وفقاً للائحة')}
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>تفاصيل المباشرة</h3>
                            <p>
                                نشهد بأن الموظف/ة <strong>${employee.name}</strong> حامل/ة الرقم الوظيفي 
                                <strong>${employee.employeeId}</strong> قد باشر/ت العمل في منصب 
                                <strong>${employee.position}</strong> بقسم <strong>${employee.department}</strong>
                                اعتباراً من تاريخ <strong>${formatDateForDisplay(employee.hireDate)}</strong> وفقاً للأنظمة واللوائح المعمول بها.
                            </p>
                        </div>

                        <div class="form-section">
                            <h3>التعهدات والالتزامات</h3>
                            <div class="checkbox-group">
                                ${generateCheckbox('الالتزام بقوانين ولوائح المؤسسة')}
                                ${generateCheckbox('المحافظة على سرية المعلومات')}
                                ${generateCheckbox('الالتزام بأوقات العمل الرسمية')}
                                ${generateCheckbox('احترام زملاء العمل والطلاب')}
                            </div>
                        </div>
                    </div>

                    ${generateFormFooter()}
                </div>
            `;
        }

        function generateVacationForm(employee) {
            const companyName = document.getElementById('company-name')?.value || 'مدرسة الثروات الوطنية الخاصة';
            const companyAddress = document.getElementById('company-address')?.value || 'دولة الإمارات العربية المتحدة، أبوظبي، بني ياس شرق 9';
            
            return `
                <div class="form-template">
                    ${generateFormHeader(companyName, companyAddress)}
                    
                    <div class="form-header">
                        <h1 class="form-title">طلب إجازة</h1>
                        <p class="form-subtitle">نموذج طلب إجازة رسمي</p>
                        <div class="form-subtitle">رقم الطلب: VR-${employee.employeeId}-${new Date().getFullYear()}</div>
                    </div>

                    <div class="form-content">
                        <div class="form-content-grid">
                            <div class="space-y-1">
                                ${generateInfoField('اسم الموظف', employee.name)}
                                ${generateInfoField('الرقم الوظيفي', employee.employeeId)}
                                ${generateInfoField('المسمى الوظيفي', employee.position)}
                                ${generateInfoField('القسم', employee.department)}
                            </div>
                            <div class="space-y-1">
                                ${generateInfoField('تاريخ التعيين', formatDateForDisplay(employee.hireDate))}
                                ${generateInfoField('تاريخ الطلب', formatDateForDisplay(new Date()))}
                                ${generateInfoField('رقم الهاتف', employee.phone)}
                                ${generateInfoField('سنوات الخدمة', calculateExperience(employee.hireDate))}
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>تفاصيل الإجازة</h3>
                            <div class="grid grid-cols-2 gap-2">
                                <div class="space-y-2">
                                    ${generateEditableField('تاريخ بداية الإجازة')}
                                    ${generateEditableField('تاريخ نهاية الإجازة')}
                                    ${generateEditableField('عدد أيام الإجازة')}
                                </div>
                                <div class="space-y-1">
                                    <label class="block text-xs font-medium text-gray-700 mb-1">نوع الإجازة</label>
                                    <div class="checkbox-group">
                                        ${generateCheckbox('إجازة سنوية')}
                                        ${generateCheckbox('إجازة مرضية')}
                                        ${generateCheckbox('إجازة طارئة')}
                                        ${generateCheckbox('إجازة أمومة')}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>سبب الإجازة</h3>
                            <div class="editable-field" style="min-height: 20px;"></div>
                        </div>
                    </div>

                    ${generateFormFooter(true)}
                </div>
            `;
        }

        function generateSalaryCertificateForm(employee) {
            const companyName = document.getElementById('company-name')?.value || 'مدرسة الثروات الوطنية الخاصة';
            const companyAddress = document.getElementById('company-address')?.value || 'دولة الإمارات العربية المتحدة، أبوظبي، بني ياس شرق 9';
            
            return `
                <div class="form-template">
                    ${generateFormHeader(companyName, companyAddress)}
                    
                    <div class="form-header">
                        <h1 class="form-title">شهادة راتب</h1>
                        <p class="form-subtitle">إثبات راتب رسمي</p>
                        <div class="form-subtitle">رقم المستند: SC-${employee.employeeId}-${new Date().getFullYear()}</div>
                    </div>

                    <div class="form-content">
                        <div class="form-content-grid">
                            <div class="space-y-1">
                                ${generateInfoField('الاسم الكامل', employee.name)}
                                ${generateInfoField('الرقم الوظيفي', employee.employeeId)}
                                ${generateInfoField('المسمى الوظيفي', employee.position)}
                                ${generateInfoField('القسم', employee.department)}
                            </div>
                            <div class="space-y-1">
                                ${generateInfoField('تاريخ التعيين', formatDateForDisplay(employee.hireDate))}
                                ${generateInfoField('تاريخ الإصدار', formatDateForDisplay(new Date()))}
                                ${generateInfoField('رقم الهوية', employee.nationalId)}
                                ${generateInfoField('سنوات الخدمة', calculateExperience(employee.hireDate))}
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>تفاصيل الراتب</h3>
                            <div class="grid grid-cols-2 gap-2">
                                <div class="space-y-2">
                                    ${generateInfoField('الراتب الأساسي', employee.salary ? employee.salary + ' درهم' : 'وفقاً للائحة')}
                                    ${generateEditableField('البدلات والإضافات')}
                                    ${generateEditableField('إجمالي الراتب الشهري')}
                                </div>
                                <div class="space-y-2">
                                    ${generateEditableField('الراتب السنوي')}
                                    ${generateEditableField('تاريخ آخر زيادة')}
                                    ${generateEditableField('مقدار آخر زيادة')}
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>إقرار رسمي</h3>
                            <p>
                                نشهد بأن الموظف/ة <strong>${employee.name}</strong> يعمل/تعمل لدينا في منصب 
                                <strong>${employee.position}</strong> بقسم <strong>${employee.department}</strong>
                                ويتقاضى راتباً شهرياً قدره <strong>${employee.salary ? employee.salary + ' درهم' : '_______ درهم'}</strong>
                                وقد أُعطيت له هذه الشهادة بناءً على طلبه دون أدنى مسؤولية علينا.
                            </p>
                        </div>
                    </div>

                    ${generateFormFooter()}
                </div>
            `;
        }

        function generateExperienceCertificateForm(employee) {
            const companyName = document.getElementById('company-name')?.value || 'مدرسة الثروات الوطنية الخاصة';
            const companyAddress = document.getElementById('company-address')?.value || 'دولة الإمارات العربية المتحدة، أبوظبي، بني ياس شرق 9';
            
            return `
                <div class="form-template">
                    ${generateFormHeader(companyName, companyAddress)}
                    
                    <div class="form-header">
                        <h1 class="form-title">شهادة خبرة</h1>
                        <p class="form-subtitle">إثبات خبرة مهنية</p>
                        <div class="form-subtitle">رقم المستند: EC-${employee.employeeId}-${new Date().getFullYear()}</div>
                    </div>

                    <div class="form-content">
                        <div class="form-content-grid">
                            <div class="space-y-1">
                                ${generateInfoField('الاسم الكامل', employee.name)}
                                ${generateInfoField('الرقم الوظيفي', employee.employeeId)}
                                ${generateInfoField('المسمى الوظيفي', employee.position)}
                                ${generateInfoField('القسم', employee.department)}
                            </div>
                            <div class="space-y-1">
                                ${generateInfoField('تاريخ التعيين', formatDateForDisplay(employee.hireDate))}
                                ${generateInfoField('تاريخ الإصدار', formatDateForDisplay(new Date()))}
                                ${generateInfoField('سنوات الخدمة', calculateExperience(employee.hireDate))}
                                ${generateInfoField('رقم الهوية', employee.nationalId)}
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>تفاصيل الخبرة المهنية</h3>
                            <div class="space-y-2">
                                ${generateEditableField('المهام والمسؤوليات الرئيسية')}
                                ${generateEditableField('الإنجازات البارزة')}
                                ${generateEditableField('المهارات المكتسبة')}
                                ${generateEditableField('التدريبات والدورات المحضرة')}
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>إقرار رسمي</h3>
                            <p>
                                نشهد بأن الموظف/ة <strong>${employee.name}</strong> قد عمل/ت لدينا في منصب 
                                <strong>${employee.position}</strong> بقسم <strong>${employee.department}</strong>
                                لمدة <strong>${calculateExperience(employee.hireDate)}</strong> من تاريخ 
                                <strong>${formatDateForDisplay(employee.hireDate)}</strong> وحتى تاريخ إصدار هذه الشهادة.
                                وقد أظهر/ت خلال فترة عمله/ا كفاءة عالية والتزاماً في أداء واجباته/ا المهنية.
                            </p>
                        </div>
                    </div>

                    ${generateFormFooter()}
                </div>
            `;
        }

        function generateUnpaidVacationForm(employee) {
            const companyName = document.getElementById('company-name')?.value || 'مدرسة الثروات الوطنية الخاصة';
            const companyAddress = document.getElementById('company-address')?.value || 'دولة الإمارات العربية المتحدة، أبوظبي، بني ياس شرق 9';
            
            return `
                <div class="form-template">
                    ${generateFormHeader(companyName, companyAddress)}
                    
                    <div class="form-header">
                        <h1 class="form-title">طلب إجازة بدون راتب</h1>
                        <p class="form-subtitle">نموذج طلب إجازة بدون راتب رسمي</p>
                        <div class="form-subtitle">رقم الطلب: UV-${employee.employeeId}-${new Date().getFullYear()}</div>
                    </div>

                    <div class="form-content">
                        <div class="form-content-grid">
                            <div class="space-y-1">
                                ${generateInfoField('اسم الموظف', employee.name)}
                                ${generateInfoField('الرقم الوظيفي', employee.employeeId)}
                                ${generateInfoField('المسمى الوظيفي', employee.position)}
                                ${generateInfoField('القسم', employee.department)}
                            </div>
                            <div class="space-y-1">
                                ${generateInfoField('تاريخ التعيين', formatDateForDisplay(employee.hireDate))}
                                ${generateInfoField('تاريخ الطلب', formatDateForDisplay(new Date()))}
                                ${generateInfoField('سنوات الخدمة', calculateExperience(employee.hireDate))}
                                ${generateInfoField('رقم الهاتف', employee.phone)}
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>تفاصيل الإجازة بدون راتب</h3>
                            <div class="grid grid-cols-2 gap-2">
                                <div class="space-y-2">
                                    ${generateEditableField('تاريخ بداية الإجازة')}
                                    ${generateEditableField('تاريخ نهاية الإجازة')}
                                    ${generateEditableField('عدد الأيام المطلوبة')}
                                </div>
                                <div class="space-y-2">
                                    ${generateEditableField('سبب طلب الإجازة')}
                                    ${generateEditableField('عنوان الإقامة أثناء الإجازة')}
                                    ${generateEditableField('رقم الهاتف أثناء الإجازة')}
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>أسباب طلب الإجازة</h3>
                            <div class="checkbox-group">
                                ${generateCheckbox('ظروف عائلية خاصة')}
                                ${generateCheckbox('سفر للخارج لفترة طويلة')}
                                ${generateCheckbox('دراسة أو تدريب')}
                                ${generateCheckbox('مرافقة أحد أفراد الأسرة للعلاج')}
                                ${generateCheckbox('ظروف صحية شخصية')}
                                ${generateCheckbox('أسباب أخرى')}
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>تعهدات الموظف</h3>
                            <div class="space-y-1">
                                ${generateCheckbox('أتعهد بعدم تقاضي أي راتب أو مستحقات خلال فترة الإجازة')}
                                ${generateCheckbox('أتعهد بالعودة في التاريخ المحدد وعدم تمديد الإجازة إلا بموافقة مسبقة')}
                                ${generateCheckbox('أتعهد بتسليم جميع المهام والملفات قبل بداية الإجازة')}
                                ${generateCheckbox('أوافق على إيقاف جميع المزايا والبدلات خلال فترة الإجازة')}
                            </div>
                        </div>
                    </div>

                    ${generateFormFooter(true)}
                </div>
            `;
        }

        function generateCustodyReceiveForm(employee) {
            const companyName = document.getElementById('company-name')?.value || 'مدرسة الثروات الوطنية الخاصة';
            const companyAddress = document.getElementById('company-address')?.value || 'دولة الإمارات العربية المتحدة، أبوظبي، بني ياس شرق 9';
            
            return `
                <div class="form-template">
                    ${generateFormHeader(companyName, companyAddress)}
                    
                    <div class="form-header">
                        <h1 class="form-title">محضر استلام عهدة</h1>
                        <p class="form-subtitle">محضر رسمي لاستلام العهدات والأصول</p>
                        <div class="form-subtitle">رقم المحضر: CR-${employee.employeeId}-${new Date().getFullYear()}</div>
                    </div>

                    <div class="form-content">
                        <div class="form-content-grid">
                            <div class="space-y-1">
                                ${generateInfoField('اسم المستلم', employee.name)}
                                ${generateInfoField('الرقم الوظيفي', employee.employeeId)}
                                ${generateInfoField('المسمى الوظيفي', employee.position)}
                                ${generateInfoField('القسم', employee.department)}
                            </div>
                            <div class="space-y-1">
                                ${generateInfoField('تاريخ الاستلام', formatDateForDisplay(new Date()))}
                                ${generateInfoField('رقم الهوية', employee.nationalId)}
                                ${generateEditableField('اسم المسلم')}
                                ${generateEditableField('صفة المسلم')}
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>تفاصيل العهدة المستلمة</h3>
                            <table class="form-table">
                                <thead>
                                    <tr>
                                        <th>م</th>
                                        <th>اسم العهدة</th>
                                        <th>النوع/الطراز</th>
                                        <th>الرقم التسلسلي</th>
                                        <th>الحالة</th>
                                        <th>ملاحظات</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${Array(6).fill(0).map((_, i) => `
                                        <tr>
                                            <td>${i + 1}</td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>

                        <div class="form-section">
                            <h3>شروط وأحكام الاستلام</h3>
                            <div class="space-y-1">
                                ${generateCheckbox('تم فحص جميع العهد المذكورة أعلاه والتأكد من سلامتها')}
                                ${generateCheckbox('أتعهد بالمحافظة على العهد وصيانتها وعدم إساءة استخدامها')}
                                ${generateCheckbox('أتعهد بإرجاع العهد في نفس الحالة التي استلمتها بها')}
                                ${generateCheckbox('أوافق على خصم قيمة أي عهدة تالفة أو مفقودة من راتبي')}
                                ${generateCheckbox('أتعهد بعدم إخراج أي عهدة من مقر العمل دون إذن مسبق')}
                            </div>
                        </div>
                    </div>

                    ${generateFormFooter()}
                </div>
            `;
        }

        function generateCustodyHandoverForm(employee) {
            const companyName = document.getElementById('company-name')?.value || 'مدرسة الثروات الوطنية الخاصة';
            const companyAddress = document.getElementById('company-address')?.value || 'دولة الإمارات العربية المتحدة، أبوظبي، بني ياس شرق 9';
            
            return `
                <div class="form-template">
                    ${generateFormHeader(companyName, companyAddress)}
                    
                    <div class="form-header">
                        <h1 class="form-title">محضر تسليم عهدة</h1>
                        <p class="form-subtitle">محضر رسمي لتسليم العهدات والأصول</p>
                        <div class="form-subtitle">رقم المحضر: CH-${employee.employeeId}-${new Date().getFullYear()}</div>
                    </div>

                    <div class="form-content">
                        <div class="form-content-grid">
                            <div class="space-y-1">
                                ${generateInfoField('اسم المسلم', employee.name)}
                                ${generateInfoField('الرقم الوظيفي', employee.employeeId)}
                                ${generateInfoField('المسمى الوظيفي', employee.position)}
                                ${generateInfoField('القسم', employee.department)}
                            </div>
                            <div class="space-y-1">
                                ${generateInfoField('تاريخ التسليم', formatDateForDisplay(new Date()))}
                                ${generateInfoField('رقم الهوية', employee.nationalId)}
                                ${generateEditableField('اسم المستلم')}
                                ${generateEditableField('صفة المستلم')}
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>تفاصيل العهدة المسلمة</h3>
                            <table class="form-table">
                                <thead>
                                    <tr>
                                        <th>م</th>
                                        <th>اسم العهدة</th>
                                        <th>النوع/الطراز</th>
                                        <th>الرقم التسلسلي</th>
                                        <th>الحالة عند التسليم</th>
                                        <th>ملاحظات</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${Array(6).fill(0).map((_, i) => `
                                        <tr>
                                            <td>${i + 1}</td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>

                        <div class="form-section">
                            <h3>إقرار التسليم والاستلام</h3>
                            <div class="space-y-1">
                                ${generateCheckbox('تم تسليم جميع العهد المذكورة أعلاه في حالة جيدة')}
                                ${generateCheckbox('تم فحص جميع العهد من قبل المستلم والتأكد من سلامتها')}
                                ${generateCheckbox('لا توجد أي عهد مفقودة أو تالفة')}
                                ${generateCheckbox('تم تسليم جميع المفاتيح والرموز الخاصة بالعهد')}
                                ${generateCheckbox('تم إبراء ذمة المسلم من جميع العهد المذكورة')}
                            </div>
                        </div>
                    </div>

                    <div class="form-footer">
                        <div class="signature-grid-2">
                            <div class="signature-section">
                                <div class="mb-2 font-semibold text-gray-800 text-xs">المسلم</div>
                                <div class="signature-line"></div>
                                <div class="text-xs text-gray-600">الاسم: ${employee.name}</div>
                                <div class="text-xs text-gray-600 mt-1">التوقيع: _______</div>
                                <div class="text-xs text-gray-600 mt-1">التاريخ: _______</div>
                            </div>
                            <div class="signature-section">
                                <div class="mb-2 font-semibold text-gray-800 text-xs">المستلم</div>
                                <div class="signature-line"></div>
                                <div class="text-xs text-gray-600">الاسم: _______</div>
                                <div class="text-xs text-gray-600 mt-1">التوقيع: _______</div>
                                <div class="text-xs text-gray-600 mt-1">التاريخ: _______</div>
                            </div>
                        </div>

                        <div class="text-center mt-4">
                            <div class="mb-2 font-semibold text-gray-800 text-xs">اعتماد مسؤول العهد</div>
                            <div class="signature-line mx-auto" style="width: 80px;"></div>
                            <div class="text-xs text-gray-600">التوقيع والختم</div>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateServiceTerminationForm(employee) {
            const companyName = document.getElementById('company-name')?.value || 'مدرسة الثروات الوطنية الخاصة';
            const companyAddress = document.getElementById('company-address')?.value || 'دولة الإمارات العربية المتحدة، أبوظبي، بني ياس شرق 9';
            
            return `
                <div class="form-template">
                    ${generateFormHeader(companyName, companyAddress)}
                    
                    <div class="form-header">
                        <h1 class="form-title">قرار إنهاء الخدمات</h1>
                        <p class="form-subtitle">قرار رسمي بإنهاء خدمات الموظف</p>
                        <div class="form-subtitle">رقم القرار: ST-${employee.employeeId}-${new Date().getFullYear()}</div>
                    </div>

                    <div class="form-content">
                        <div class="form-content-grid">
                            <div class="space-y-1">
                                ${generateInfoField('اسم الموظف', employee.name)}
                                ${generateInfoField('الرقم الوظيفي', employee.employeeId)}
                                ${generateInfoField('المسمى الوظيفي', employee.position)}
                                ${generateInfoField('القسم', employee.department)}
                            </div>
                            <div class="space-y-1">
                                ${generateInfoField('تاريخ التعيين', formatDateForDisplay(employee.hireDate))}
                                ${generateInfoField('تاريخ القرار', formatDateForDisplay(new Date()))}
                                ${generateInfoField('مدة الخدمة', calculateExperience(employee.hireDate))}
                                ${generateInfoField('رقم الهوية', employee.nationalId)}
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>تفاصيل إنهاء الخدمة</h3>
                            <div class="grid grid-cols-2 gap-2">
                                <div class="space-y-2">
                                    ${generateEditableField('تاريخ انتهاء الخدمة')}
                                    ${generateEditableField('سبب إنهاء الخدمة')}
                                    ${generateEditableField('فترة الإنذار (إن وجدت)')}
                                </div>
                                <div class="space-y-2">
                                    ${generateEditableField('آخر يوم عمل')}
                                    ${generateEditableField('المستحقات المالية')}
                                    ${generateEditableField('مدة تسليم العهد')}
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>أسباب إنهاء الخدمة</h3>
                            <div class="checkbox-group">
                                ${generateCheckbox('انتهاء عقد العمل')}
                                ${generateCheckbox('استقالة الموظف')}
                                ${generateCheckbox('إنهاء الخدمة لأسباب تأديبية')}
                                ${generateCheckbox('إعادة هيكلة الوظائف')}
                                ${generateCheckbox('عدم تجديد العقد')}
                                ${generateCheckbox('ظروف صحية')}
                                ${generateCheckbox('أسباب أخرى')}
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>الإجراءات المطلوبة من الموظف</h3>
                            <div class="space-y-1">
                                ${generateCheckbox('تسليم جميع العهد والأصول المسؤول عنها')}
                                ${generateCheckbox('إنهاء جميع المعاملات المالية المعلقة')}
                                ${generateCheckbox('تسليم المفاتيح والبطاقات الأمنية')}
                                ${generateCheckbox('إنهاء الملفات والمشاريع الجارية')}
                                ${generateCheckbox('تسليم كلمات المرور والحسابات الإلكترونية')}
                                ${generateCheckbox('إزالة جميع البيانات الشخصية من أجهزة الشركة')}
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>إقرار رسمي</h3>
                            <p>
                                بناءً على ما تقدم، يتم إنهاء خدمات الموظف/ة <strong>${employee.name}</strong> 
                                الذي/التي يشغل/تشغل منصب <strong>${employee.position}</strong> 
                                اعتباراً من تاريخ _____________ وذلك وفقاً للأنظمة واللوائح المعمول بها في المؤسسة.
                            </p>
                        </div>
                    </div>

                    ${generateFormFooter(true)}
                </div>
            `;
        }

        function generateResignationForm(employee) {
            const companyName = document.getElementById('company-name')?.value || 'مدرسة الثروات الوطنية الخاصة';
            const companyAddress = document.getElementById('company-address')?.value || 'دولة الإمارات العربية المتحدة، أبوظبي، بني ياس شرق 9';
            
            return `
                <div class="form-template">
                    ${generateFormHeader(companyName, companyAddress)}
                    
                    <div class="form-header">
                        <h1 class="form-title">طلب استقالة</h1>
                        <p class="form-subtitle">طلب رسمي للاستقالة من الخدمة</p>
                        <div class="form-subtitle">رقم الطلب: RS-${employee.employeeId}-${new Date().getFullYear()}</div>
                    </div>

                    <div class="form-content">
                        <div class="form-content-grid">
                            <div class="space-y-1">
                                ${generateInfoField('اسم الموظف', employee.name)}
                                ${generateInfoField('الرقم الوظيفي', employee.employeeId)}
                                ${generateInfoField('المسمى الوظيفي', employee.position)}
                                ${generateInfoField('القسم', employee.department)}
                            </div>
                            <div class="space-y-1">
                                ${generateInfoField('تاريخ التعيين', formatDateForDisplay(employee.hireDate))}
                                ${generateInfoField('تاريخ الطلب', formatDateForDisplay(new Date()))}
                                ${generateInfoField('مدة الخدمة', calculateExperience(employee.hireDate))}
                                ${generateInfoField('رقم الهوية', employee.nationalId)}
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>تفاصيل الاستقالة</h3>
                            <div class="grid grid-cols-2 gap-2">
                                <div class="space-y-2">
                                    ${generateEditableField('تاريخ الاستقالة المرغوب')}
                                    ${generateEditableField('آخر يوم عمل مقترح')}
                                    ${generateEditableField('فترة الإشعار المقترحة')}
                                </div>
                                <div class="space-y-2">
                                    ${generateEditableField('الوظيفة الجديدة (اختياري)')}
                                    ${generateEditableField('سبب الاستقالة الرئيسي')}
                                    ${generateEditableField('عنوان التواصل بعد ترك العمل')}
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>أسباب الاستقالة</h3>
                            <div class="checkbox-group">
                                ${generateCheckbox('فرصة عمل أفضل')}
                                ${generateCheckbox('ظروف شخصية أو عائلية')}
                                ${generateCheckbox('الانتقال لمدينة أخرى')}
                                ${generateCheckbox('الرغبة في تغيير المجال')}
                                ${generateCheckbox('بدء مشروع خاص')}
                                ${generateCheckbox('متابعة الدراسة أو التدريب')}
                                ${generateCheckbox('ظروف صحية')}
                                ${generateCheckbox('أسباب أخرى')}
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>التزامات الموظف قبل ترك العمل</h3>
                            <div class="space-y-1">
                                ${generateCheckbox('أتعهد بإنهاء جميع المشاريع والمهام المكلف بها')}
                                ${generateCheckbox('أتعهد بتسليم جميع العهد والأصول للإدارة')}
                                ${generateCheckbox('أتعهد بتدريب البديل أو نقل المعرفة المطلوبة')}
                                ${generateCheckbox('أتعهد بالحفاظ على سرية المعلومات حتى بعد ترك العمل')}
                                ${generateCheckbox('أتعهد بإنهاء جميع المعاملات المالية المعلقة')}
                                ${generateCheckbox('أوافق على خصم أي مستحقات على الشركة من آخر راتب')}
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>تقييم تجربة العمل</h3>
                            <div class="space-y-2">
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">ما هي أفضل جوانب العمل في هذه المؤسسة؟</label>
                                    <div class="editable-field" style="min-height: 16px;"></div>
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">ما هي المجالات التي يمكن تحسينها؟</label>
                                    <div class="editable-field" style="min-height: 16px;"></div>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" class="rounded border-gray-300">
                                    <span>هل تنصح الآخرين بالعمل في هذه المؤسسة؟</span>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>إقرار الاستقالة</h3>
                            <p>
                                أتقدم أنا الموظف/ة <strong>${employee.name}</strong> بطلب الاستقالة من منصب 
                                <strong>${employee.position}</strong> بقسم <strong>${employee.department}</strong>
                                وأشكر الإدارة على الفرصة المتاحة وأتطلع للحصول على الموافقة في أقرب وقت ممكن.
                            </p>
                        </div>
                    </div>

                    ${generateFormFooter(true)}
                </div>
            `;
        }

        // Export and save functions
        function saveForm() {
            if (!currentEmployee) {
                showNotification('لا يوجد نموذج لحفظه', 'error');
                return;
            }
            
            const formData = {
                employee: currentEmployee,
                content: document.getElementById('form-preview').innerHTML,
                timestamp: new Date().toISOString(),
                type: 'saved_form'
            };

            try {
                // Save to Firebase
                db.collection('forms').add(formData);
                showNotification('تم حفظ النموذج في Firebase', 'success');
            } catch (error) {
                console.error('Error saving form:', error);
                showNotification('حدث خطأ في حفظ النموذج', 'error');
            }
        }

        async function exportToPDF() {
            if (!currentEmployee) {
                showNotification('يرجى توليد نموذج أولاً', 'error');
                return;
            }

            try {
                showNotification('جاري إنشاء ملف PDF...', 'info');
                
                const element = document.getElementById('form-preview');
                
                const canvas = await html2canvas(element, {
                    scale: 2,
                    useCORS: true,
                    allowTaint: true,
                    backgroundColor: '#ffffff',
                    width: element.scrollWidth,
                    height: element.scrollHeight,
                    scrollX: 0,
                    scrollY: 0
                });

                const { jsPDF } = window.jspdf;
                
                const pageWidth = 210; // A4 width in mm
                const pageHeight = 297; // A4 height in mm
                
                const imgWidth = pageWidth - 20;
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                
                const doc = new jsPDF('p', 'mm', 'a4');
                const imgData = canvas.toDataURL('image/png', 0.9);
                
                const xOffset = 10;
                const yOffset = 10;
                
                doc.addImage(imgData, 'PNG', xOffset, yOffset, imgWidth, imgHeight);

                const fileName = `نموذج_${currentEmployee.name}_${new Date().toISOString().split('T')[0]}.pdf`;
                doc.save(fileName);
                showNotification('تم تصدير PDF بنجاح', 'success');
            } catch (error) {
                console.error('Error exporting PDF:', error);
                showNotification('حدث خطأ في تصدير PDF', 'error');
            }
        }

        function printForm() {
            if (!currentEmployee) {
                showNotification('يرجى توليد نموذج أولاً', 'error');
                return;
            }
            window.print();
        }

        function exportAllData() {
            const worksheet = XLSX.utils.json_to_sheet(employees);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, 'الموظفين');
            
            XLSX.writeFile(workbook, `تقرير_شامل_${new Date().toISOString().split('T')[0]}.xlsx`);
            showNotification('تم تصدير البيانات الشاملة بنجاح', 'success');
        }

        // Backup functions
        async function createBackup() {
            try {
                showNotification('جاري إنشاء النسخة الاحتياطية...', 'info');
                
                const backupData = {
                    employees: employees,
                    settings: {
                        companyName: document.getElementById('company-name')?.value || 'مدرسة الثروات الوطنية الخاصة',
                        companyAddress: document.getElementById('company-address')?.value || 'دولة الإمارات العربية المتحدة، أبوظبي، بني ياس شرق 9',
                        companyPhone: document.getElementById('company-phone')?.value || '025551234',
                        companyEmail: document.getElementById('company-email')?.value || 'info@alserowat-school.ae'
                    },
                    timestamp: new Date().toISOString(),
                    version: '2.0'
                };

                // Save to Firebase
                await db.collection('backups').add(backupData);

                // Also download as file
                const dataStr = JSON.stringify(backupData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `hr_backup_${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                URL.revokeObjectURL(url);
                showNotification('تم إنشاء النسخة الاحتياطية وحفظها في Firebase', 'success');
            } catch (error) {
                console.error('Error creating backup:', error);
                showNotification('حدث خطأ في إنشاء النسخة الاحتياطية', 'error');
            }
        }

        function initializeBackupRestore() {
            const backupFile = document.getElementById('backup-file');
            if (backupFile) {
                backupFile.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            try {
                                const backupData = JSON.parse(e.target.result);
                                restoreFromBackup(backupData);
                            } catch (error) {
                                showNotification('ملف النسخة الاحتياطية غير صحيح', 'error');
                            }
                        };
                        reader.readAsText(file);
                    }
                });
            }
        }

        async function restoreFromBackup(backupData) {
            showConfirmDialog(
                'هل أنت متأكد من استعادة النسخة الاحتياطية؟ سيتم استبدال جميع البيانات الحالية.',
                async () => {
                    try {
                        showNotification('جاري استعادة النسخة الاحتياطية...', 'info');
                        
                        // Clear current data in Firebase
                        const batch = db.batch();
                        const employeesSnapshot = await db.collection('employees').get();
                        employeesSnapshot.forEach(doc => {
                            batch.delete(doc.ref);
                        });
                        await batch.commit();
                        
                        // Restore employees to Firebase
                        for (const employee of backupData.employees || []) {
                            delete employee.id; // Remove old ID
                            await db.collection('employees').add({
                                ...employee,
                                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                            });
                        }
                        
                        // Restore settings
                        if (backupData.settings) {
                            if (document.getElementById('company-name')) {
                                document.getElementById('company-name').value = backupData.settings.companyName;
                            }
                            if (document.getElementById('company-address')) {
                                document.getElementById('company-address').value = backupData.settings.companyAddress;
                            }
                            if (document.getElementById('company-phone')) {
                                document.getElementById('company-phone').value = backupData.settings.companyPhone;
                            }
                            if (document.getElementById('company-email')) {
                                document.getElementById('company-email').value = backupData.settings.companyEmail;
                            }
                        }
                        
                        // Reload data
                        await loadEmployeesFromFirebase();
                        
                        showNotification('تم استعادة النسخة الاحتياطية بنجاح', 'success');
                        addToActivityLog('تم استعادة نسخة احتياطية من Firebase');
                        
                    } catch (error) {
                        console.error('Error restoring backup:', error);
                        showNotification('حدث خطأ في استعادة النسخة الاحتياطية', 'error');
                    }
                }
            );
        }

        // Utility Functions
        function formatDateForDisplay(date) {
            if (!date) return '';
            const d = new Date(date);
            return d.toLocaleDateString('en-GB', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit'
            });
        }

        function calculateExperience(hireDate) {
            if (!hireDate) return 'غير محدد';
            
            const hire = new Date(hireDate);
            const now = new Date();
            const diffTime = Math.abs(now - hire);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            const years = Math.floor(diffDays / 365);
            const months = Math.floor((diffDays % 365) / 30);
            
            if (years > 0) {
                return `${years} سنة و ${months} شهر`;
            } else {
                return `${months} شهر`;
            }
        }

        function updateCurrentTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-GB', {
                hour: '2-digit',
                minute: '2-digit'
            });
            const dateString = now.toLocaleDateString('en-GB');
            if (document.getElementById('current-time')) {
                document.getElementById('current-time').textContent = `${timeString} - ${dateString}`;
            }
        }

        // Notification System
        function showNotification(message, type = 'info', duration = 3000) {
            const notification = document.createElement('div');
            notification.className = `notification fixed top-4 left-4 z-50 p-4 rounded-lg shadow-lg max-w-sm transform transition-all duration-300 translate-x-full opacity-0`;
            
            const colors = {
                success: 'bg-green-500 text-white',
                error: 'bg-red-500 text-white',
                warning: 'bg-yellow-500 text-white',
                info: 'bg-blue-500 text-white'
            };
            
            const icons = {
                success: 'fas fa-check-circle',
                error: 'fas fa-exclamation-circle',
                warning: 'fas fa-exclamation-triangle',
                info: 'fas fa-info-circle'
            };

            notification.className += ` ${colors[type]}`;
            notification.innerHTML = `
                <div class="flex items-center space-x-3 space-x-reverse">
                    <i class="${icons[type]}"></i>
                    <span>${message}</span>
                    <button onclick="this.closest('.notification').remove()" class="mr-auto text-white hover:text-gray-200">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;

            const container = document.getElementById('notifications-container');
            if (container) {
                container.appendChild(notification);

                setTimeout(() => {
                    notification.classList.remove('translate-x-full', 'opacity-0');
                }, 100);

                setTimeout(() => {
                    notification.classList.add('translate-x-full', 'opacity-0');
                    setTimeout(() => notification.remove(), 300);
                }, duration);
            }
        }

        function showConfirmDialog(message, onConfirm) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-md w-full mx-4 animate-scale-in">
                    <div class="flex items-center mb-4">
                        <i class="fas fa-exclamation-triangle text-yellow-500 text-xl ml-3"></i>
                        <h3 class="text-lg font-bold text-gray-900 dark:text-white">تأكيد العملية</h3>
                    </div>
                    <p class="text-gray-700 dark:text-gray-300 mb-6">${message}</p>
                    <div class="flex justify-end space-x-3 space-x-reverse">
                        <button onclick="this.closest('.fixed').remove()" class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors">
                            إلغاء
                        </button>
                        <button onclick="(${onConfirm.toString()})(); this.closest('.fixed').remove();" class="px-4 py-2 bg-red-500 text-white hover:bg-red-600 rounded transition-colors">
                            تأكيد
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Activity Log
        function addToActivityLog(activity) {
            const recentActivity = document.getElementById('recent-activity');
            if (recentActivity) {
                const activityItem = document.createElement('div');
                activityItem.className = 'flex items-center space-x-3 space-x-reverse p-3 bg-gray-50 dark:bg-gray-700 rounded-lg animate-fade-in';
                activityItem.innerHTML = `
                    <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                    <div class="flex-1">
                        <p class="text-sm text-gray-900 dark:text-white">${activity}</p>
                        <p class="text-xs text-gray-500 dark:text-gray-400">${new Date().toLocaleTimeString('en-GB')}</p>
                    </div>
                `;
                
                recentActivity.insertBefore(activityItem, recentActivity.firstChild);
                
                while (recentActivity.children.length > 5) {
                    recentActivity.removeChild(recentActivity.lastChild);
                }
            }
        }

        // Settings
        function initializeSettings() {
            const companyForm = document.getElementById('company-settings-form');
            if (companyForm) {
                companyForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    try {
                        const settings = {
                            companyName: document.getElementById('company-name').value,
                            companyAddress: document.getElementById('company-address').value,
                            companyPhone: document.getElementById('company-phone').value,
                            companyEmail: document.getElementById('company-email').value,
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        };
                        
                        await db.collection('settings').doc('company').set(settings);
                        showNotification('تم حفظ إعدادات المدرسة في Firebase', 'success');
                        addToActivityLog('تم تحديث إعدادات المدرسة');
                    } catch (error) {
                        console.error('Error saving settings:', error);
                        showNotification('حدث خطأ في حفظ الإعدادات', 'error');
                    }
                });
            }
        }

        // Initialize Charts
        function initializeCharts() {
            const departmentData = {};
            employees.forEach(emp => {
                departmentData[emp.department] = (departmentData[emp.department] || 0) + 1;
            });

            if (document.getElementById('quick-chart')) {
                const quickChart = new Chart(document.getElementById('quick-chart'), {
                    type: 'bar',
                    data: {
                        labels: ['موظفين', 'نماذج', 'إجازات'],
                        datasets: [{
                            data: [employees.length, generatedForms, 5],
                            backgroundColor: ['#667eea', '#764ba2', '#f093fb'],
                            borderRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
                charts.quickChart = quickChart;
            }
        }

        // Initialize App
        async function initializeApp() {
            try {
                // Initialize theme
                initializeTheme();
                
                // Update time
                updateCurrentTime();
                setInterval(updateCurrentTime, 60000);
                
                // Initialize event listeners
                initializeLogoUpload();
                initializeEmployeeForm();
                initializeExcelImport();
                initializeFilters();
                initializeBackupRestore();
                initializeSettings();
                
                // Load data from Firebase
                await loadEmployeesFromFirebase();
                
                // Initialize charts
                setTimeout(initializeCharts, 1000);
                
                // Show dashboard by default
                showSection('dashboard');
                
                // Hide loading screen
                setTimeout(() => {
                    const loadingScreen = document.getElementById('loading-screen');
                    if (loadingScreen) {
                        loadingScreen.style.display = 'none';
                    }
                }, 2000);
                
                // Add welcome activity
                addToActivityLog('تم تحميل النظام وإتصاله بـ Firebase بنجاح');
                
            } catch (error) {
                console.error('Error initializing app:', error);
                showNotification('حدث خطأ في تحميل النظام', 'error');
                
                // Hide loading screen even on error
                setTimeout(() => {
                    const loadingScreen = document.getElementById('loading-screen');
                    if (loadingScreen) {
                        loadingScreen.style.display = 'none';
                    }
                }, 1000);
            }
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', initializeApp);
        
        // Close sidebar when clicking overlay
        document.addEventListener('DOMContentLoaded', function() {
            const overlay = document.getElementById('sidebar-overlay');
            if (overlay) {
                overlay.addEventListener('click', toggleSidebar);
            }
        });
        
        // Handle responsive sidebar
        window.addEventListener('resize', () => {
            if (window.innerWidth >= 1024) {
                const sidebar = document.getElementById('sidebar');
                const overlay = document.getElementById('sidebar-overlay');
                if (sidebar) sidebar.classList.remove('open');
                if (overlay) overlay.classList.remove('active');
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 's':
                        e.preventDefault();
                        saveForm();
                        break;
                    case 'p':
                        e.preventDefault();
                        printForm();
                        break;
                    case 'n':
                        e.preventDefault();
                        showAddEmployeeModal();
                        break;
                }
            }
            
            if (e.key === 'Escape') {
                // Close any open modals
                document.querySelectorAll('.fixed.inset-0').forEach(modal => {
                    if (!modal.classList.contains('hidden')) {
                        modal.classList.add('hidden');
                    }
                });
                
                // Close sidebar if open
                const sidebar = document.getElementById('sidebar');
                if (sidebar && sidebar.classList.contains('open')) {
                    toggleSidebar();
                }
            }
        });
    </script>
</body>
</html>
